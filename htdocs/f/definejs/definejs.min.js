!function(e,t,n,r,i,o,s,l,a,u,c,f,d,h,p,g,m,y,w,b,v,x,j,k,C,S){const q=function(){const e={},t={};return{define:function(t,n){e[t]=n},require:function n(r){let i=t[r];if(i)return i;let o={exports:{},require:e=>n(`${r}/${e}`)};return(i=(0,e[r])(n,o,o.exports))===S&&(i=o.exports),t[r]=i,i},each(t){j.keys(e).forEach(t)}}}(),T=q.define,E=function({require:e}){let t=null;function n(){if(t)return t;const n=e("ModuleManager");return t=new n({cross:!0})}return{create:n,has:function(...e){return n().has(...e)},define:function(...e){return n().define(...e)},require:function(...e){return n().require(...e)},bind:function(e,t,r){return function(...i){var o=n().require(e),s=o[t];if("function"!=typeof s)throw new m(`要绑定的模块 ${e} 中不存在名为 ${t} 的方法或函数。`);return r=!0===r?o:r||null,s.call(r,...i)}}}}(q),N=E.define;T("ModuleManager/Module",function(e,t,n){const r=new b;t.exports=class{constructor(e,t){let n=t.seperator,i=e.split(n),o=i.slice(-1)[0],s=t.parent;s&&(s=j.create(s,{require:{value:function(t){throw new m(`禁止通过父模块来加载同级模块：模块 ${e} 尝试加载同级模块 ${t}。`)}}}));let l={id:e,seperator:n,emitter:t.emitter,mm:t.mm,this:this};r.set(this,l),j.assign(this,{id:e,name:o,names:i,seperator:n,data:t.data,exports:t.exports,parent:s})}on(...e){let t=r.get(this).emitter;t&&t.on(...e)}require(e){let t=r.get(this),n=t.seperator,i=t.id+n+e;if(e.includes(n))throw new m(`模块 ${t.id} 不允许跨级加载模块: ${i}`);return t.mm.require(i,!0)}bind(e,t){let n="object"==typeof e?e:{[e]:t},i=r.get(this);j.keys(n).forEach(function(e){let t=n[e],r="function"==typeof t?t:function(e){e.on(t)};i.this.on("require",e,r)})}render(e,...t){let n=this.require(e);if(!n)throw new m(`模块 ${meta.id} 不存在名为 ${e} 的直接子模块`);return n.render(...t),n}}}),T("ModuleManager.defaults",function(e,t,n){t.exports={Emitter:null,seperator:"/",cross:!1,repeated:!1}}),T("ModuleManager",function(e,t,n){const r=t.require("Module"),i=new b;class o{constructor(e){let t=j.assign({},n.defaults,e),r=t.Emitter,o=r?new r(this):null,s={id$module:{},id$data:{},seperator:t.seperator,cross:t.cross,repeated:t.repeated,emitter:o,Emitter:r,this:this,require:e=>s.this.require(e),fire(...e){o&&o.fire(...e)},getParent(e){let t=s.seperator,n=e.split(t);if(1==n.length)return null;let r=n.slice(0,-1).join(t);return s.id$module[r]||null}};i.set(this,s),this.on("require",function(e,t,n){t.fire("require",[n]);let r=t.parent;r&&r.fire("require",t.name,[n])})}data(e,t){if("string"!=typeof e)throw new m("参数 id 为要设置的模块的 id，必须为 string 类型。");return i.get(this).id$data[e]=t,t}define(e,t){if("string"!=typeof e)throw new m(`参数 id 的类型必须为 string，当前为: ${typeof e}`);let n=i.get(this),r=n.id$module;if(!n.repeated&&r[e])throw new m(`配置设定了不允许定义重复的模块: 已存在名为 ${e} 的模块`);let o=n.Emitter,s=o?new o:null,l=e.split(n.seperator).slice(-1)[0];r[e]={id:e,name:l,factory:t,emitter:s,parent:null,required:!1,count:0,exports:null,mod:null,fire(){s&&s.fire(...arguments)}}}require(e,t){if("string"!=typeof e)throw new m(`参数 id 的类型必须为 string，当前为: ${typeof e}`);let n=i.get(this),o=n.seperator;if(t===S&&(t=n.cross),!t&&e.includes(o))throw new m(`参数指定了或配置设定了不允许跨级加载模块: ${e}`);if(!this.has(e))return;let s=n.id$module[e];if(s.count++,s.required)return s.exports;s.required=!0;let l=s.factory,a=s.parent=n.getParent(e);if("function"!=typeof l)return s.exports=l,n.fire("require",e,[s,l]),n.fire("require",[e,s,l]),l;let u=s.exports={},c=s.mod=new r(e,{seperator:o,mm:this,emitter:s.emitter,data:n.id$data[e],exports:u,parent:a?a.mod:null});return(u=l(n.require,c,u))===S&&(u=c.exports),s.exports=u,c.exports=u,n.fire("require",e,[s,u]),n.fire("require",[e,s,u]),u}on(...e){let t=i.get(this).emitter;t&&t.on(...e)}has(e){return i.get(this).id$module.hasOwnProperty(e)}destroy(){let e=i.get(this).emitter;e&&e.destroy(),i.delete(this)}}o.defaults=e("ModuleManager.defaults"),t.exports=n=o}),N("Alert/Dialog/Height",function(e,t,n){const r=e("String");t.exports={get(e){let t=function(e){e=C(e);let t=r.getByteLength(e),n=v.max(t,125);return n>=.8*i.documentElement.clientHeight&&(n="80%"),n}(e),n=function(e){let t=25*(e=C(e)).split("\n").length+60;return t>=.8*i.documentElement.clientHeight&&(t="80%"),t}(e),o=v.max(t,n);return"number"==typeof o&&(o=o%2==1?o+1:o),o}}}),N("Alert/Dialog",function(e,t,n){const r=t.require("Height");let o=null,s=!1,l=[],a=null,u=13,c=null;function f(e,t){let n=r.get(e);(o=o||function(){let e=j.assign({},c),t=new(0,e.Dialog)({cssClass:"definejs-alert",volatile:e.volatile,mask:e.mask,autoClose:e.autoClose,width:e.width,"z-index":e["z-index"],buttons:e.buttons});return t.on("button",{ok(){let e=t.data("fn");e&&e()}}),t.on({show(){s=!0,u=13==u?"enter":"",(a=i.activeElement).blur()},hide(){s=!1;let e=l.shift();e&&f(e.text,e.fn),a=null,u=""}}),i.addEventListener("keydown",e=>{u=e.keyCode}),i.addEventListener("keyup",e=>{if(13!=e.keyCode||!s||"enter"==u)return;t.hide();let n=t.data("fn");n&&n()}),t}()).data("fn",t),o.set({content:e,height:n}),o.show()}t.exports={init(e){c=e},add(e,t){s?l.push({text:e,fn:t}):f(e,t)}}}),N("Alert/Sample",function(e,t,n){t.exports='<pre class="JSON">{text}</pre>'}),N("Alert.defaults",function(e,t,n){const r=e("Dialog");t.exports={Dialog:r,volatile:!1,mask:!0,autoClose:!0,width:450,"z-index":99999,buttons:[{text:"确定",cmd:"ok",cssClass:"OK"}]}}),N("Alert",function(e,t,n){const r=e("String"),i=t.require("Dialog"),o=t.require("Sample");t.exports=n={defaults:e("Alert.defaults"),show(e,t,s,l){"object"==typeof e&&(e=w.stringify(e,null,4),e=r.format(o,{text:e}));let a=[...arguments],u=a.findIndex(function(e,t){return"function"==typeof e});u>0?(l=a[u],a=a.slice(0,u)):l=null,e=r.format(...a),i.init(n.defaults),i.add(e,l)}}}),N("Dialog/Template/Sample",function(e,t,n){t.exports='\n    <div id="{id}" class="definejs-dialog {cssClass}" style="{style} display: none;">\n        <template name="header" placeholder="header">\n            <header id="{headerId}">\n                {title}\n            </header>\n        </template>\n    \n        <template name="content" placeholder="content">\n            <article id="{articleId}" class="{noHeader} {noFooter}">\n                <div id="{contentId}">{content}</div>\n            </article>\n        </template>\n    \n        <template name="footer" placeholder="footer">\n            <footer id="{footerId}" class="Buttons-{count}">\n                <template name="button" placeholder="buttons">\n                    <button data-index="{index}" class="{cssClass}" style="{style}">{text}</button>\n                </template>\n            </footer>\n        </template>\n    </div>\n    '}),N("Dialog/Events",function(e,t,n){const r=e("jquery");t.exports={bind(e){e.masker&&e.volatile&&e.masker.on({show(){},hide(){e.this.hide()}}),function(){if(!e.buttons.length)return;let t=e.$footer,n=e.eventName,i="button[data-index]",o=e.pressedClass;function s(t){let n=+this.getAttribute("data-index"),r=e.buttons[n],i=r.cmd||C(n),o=r.fn;o&&o(r,n),e.emitter.fire("button",i,[r,n]),e.emitter.fire("button",[r,n]);let s=r.autoClose;s===S&&(s=e.autoClose),s&&e.this.hide()}"touch"!=n?(t.on(n,i,s),t.on("mousedown",i,function(e){r(this).addClass(o)}),t.on("mouseup mouseout",i,function(e){r(this).removeClass(o)})):t.touch(i,s,o)}()}}}),N("Dialog/Masker",function(e,t,n){t.exports={create(e){let t=e.Masker,n={container:e.container},r=t.normalize(n,e.mask);return r?(j.assign(r,{volatile:e.volatile,"z-index":e["z-index"]-1}),new t(r)):null}}}),N("Dialog/Meta",function(e,t,n){const r=e("String"),i="definejs-dialog-";t.exports={create(e,t){let n=r.randomId(i,4),o=e.buttons||[];o=o.map(function(e){return"string"==e?{text:e}:e});let s={id:n,headerId:r.randomId(i,"header-",4),articleId:r.randomId(i,"article-",4),contentId:r.randomId(i,"content-",4),footerId:r.randomId(i,"footer-",4),Masker:e.Masker,Scroller:e.Scroller,scrollable:e.scrollable,scrollerConfig:e.scroller,eventName:e.eventName,title:e.title,content:e.content,buttons:o,"z-index":e["z-index"],width:e.width,height:e.height,autoClose:e.autoClose,volatile:e.volatile,cssClass:e.cssClass||"",container:e.container,pressedClass:"Pressed",visible:!1,style:{},data:{},scroller:null,masker:null,emitter:null,this:null,$:null,$header:null,$content:null,$footer:null};return j.assign(s,t),s}}}),N("Dialog/Style",function(e,t,n){const r=e("Object"),i=e("Style");t.exports={get(e){let t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),N("Dialog/Template",function(e,t,n){const r=e("Template"),i=e("Style"),o=t.require("Sample"),s=r.create(o);s.process({"":function(e){let t=this.fill("header",e),n=this.fill("content",e),r=this.fill("footer",e),o=i.stringify(e.style);return{id:e.id,cssClass:e.cssClass||"",style:o,header:t,content:n,footer:r}},header:function(e){let t=e.title;return t?{headerId:e.headerId,title:t}:""},content:function(e){return{articleId:e.articleId,contentId:e.contentId,content:e.content,noHeader:e.title?"":"NoHeader",noFooter:e.buttons.length>0?"":"NoFooter"}},footer:{"":function(e){let t=e.buttons,n=t.length;return n?(t=this.fill("button",t),{footerId:e.footerId,count:n,buttons:t}):""},button:function(e,t){let n=i.stringify(e.style);return{index:t,text:e.text,cssClass:e.cssClass||"",style:n}}}}),t.exports=s}),N("Dialog.defaults",function(e,t,n){const r=e("Masker");t.exports={Masker:r,Scroller:null,container:"body",mask:!0,autoClose:!0,volatile:!1,title:"",content:"",eventName:"click",cssClass:"","z-index":1024,width:600,height:"50%",style:{},buttons:[],scrollable:!1,scroller:null}}),N("Dialog",function(e,t,n){const r=e("jquery"),i=e("Object"),o=e("Emitter"),s=t.require("Style"),l=t.require("Meta"),a=t.require("Masker"),u=t.require("Events"),c=t.require("Template"),f=new b;class d{constructor(e){e=i.deepAssign({},n.defaults,e);let t=new o(this),r=s.get(e),u=a.create(e),c=l.create(e,{style:r,emitter:t,masker:u,this:this});f.set(this,c),j.assign(this,{id:c.id})}render(){let e=f.get(this);if(e.$)return;let t=c.fill(e);if(r(e.container).append(t),e.$=this.$=r(`#${e.id}`),e.$header=r(`#${e.headerId}`),e.$article=r(`#${e.articleId}`),e.$content=r(`#${e.contentId}`),e.$footer=r(`#${e.footerId}`),e.scrollable){let t=e.Scroller;if(!t)throw new m("你已指定了内容区域可滚动，请传入滚动器模块对应的构造函数 Scroller。");e.scroller=new t(e.$article,e.scrollerConfig),e.scroller.render()}u.bind(e),e.emitter.fire("render")}show(){let e=f.get(this);e.visible?e.scroller&&e.scroller.refresh(200):(e.$||this.render(),e.$.show(),e.visible=!0,e.masker&&e.masker.show(),e.scroller&&e.scroller.refresh(200),e.emitter.fire("show"))}hide(){let e=f.get(this);e.$&&e.visible&&(e.$.hide(),e.visible=!1,e.masker&&e.masker.hide(),e.emitter.fire("hide"))}remove(){let e=f.get(this);if(!e.$)return;e.masker&&e.masker.remove(),e.layer&&e.layer.remove();let t=e.$.get(0);t.parentNode.removeChild(t),e.$.off(),e.visible=!1,e.masker=null,e.layer=null,e.$=null,e.$header=null,e.$content=null,e.$footer=null,e.emitter.fire("remove")}on(...e){f.get(this).emitter.on(...e)}destroy(){let e=f.get(this);if(!e)throw new m("该实例已给销毁，无法再次调用 destroy 方法。");this.remove(),e.emitter.destroy(),e.scroller&&e.scroller.destroy(),f.delete(this)}set(e,n){this.render();let r=f.get(this),o=r.scroller,l="object"==typeof e?e:{[e]:n};i.each(l,function(e,n){switch(e){case"title":r.$header.html(n);break;case"content":r.$content.html(n),o&&o.refresh(200);break;case"height":case"width":let i={};i[e]=r[e]=n,i=s.get(i),j.assign(r.style,i),r.$.css(i),o&&o.refresh(300);break;default:throw new m(`${t.id} 目前不支持设置属性: ${e}`)}})}data(e,t){let n=f.get(this).data,r=arguments.length;return 0==r?n:i.isPlain(e)?(j.assign(n,e),e):1==r?n[e]:(n[e]=t,t)}}d.defaults=e("Dialog.defaults"),t.exports=n=d}),N("Emitter",function(e,t,n){const r=e("Object"),i=e("Tree"),o=new b;t.exports=class{constructor(e){let t={context:e,tree:new i};o.set(this,t)}on(e,t){if(h.isArray(e))return void(t?e.map(function(e){this.on(e,t)},this):this.on(...e));let n=o.get(this).tree,i=h.from(arguments),s=i.findIndex(function(e,t){return"object"==typeof e});if(s>=0){let e=i[s],t=i.slice(0,s);return void r.flat(e).forEach(function(e,r){let i=t.concat(e.keys),o=n.get(i)||{list:[],count:0};o.list.push(e.value),n.set(i,o)})}if((s=i.findIndex(function(e,t){return"function"==typeof e}))<0)throw new m("参数中必须指定一个回调函数");t=i[s];let l=i.slice(0,s),a=n.get(l)||{list:[],count:0,enabled:!0,spreaded:!0};a.list.push(t),n.set(l,a)}off(e,t){var n=o.get(this).tree,i=h.from(arguments);if(0!=i.length)if((a=i.findIndex(function(e,t){return"object"==typeof e}))>=0){var s=i[a],l=i.slice(0,a);(u=r.flat(s)).forEach(function(e,t){var r=l.concat(e.keys),i=n.get(r);if(i){var o=i.list;if(o&&o.length){var s=e.value;i.list=o.filter(function(e){return e!==s})}}})}else{var a;(a=i.findIndex(function(e,t){return"function"==typeof e}))<0&&(a=i.length),t=i[a],l=i.slice(0,a);var u,c=n.get(l);c&&(u=c.list)&&u.length&&(t?c.list=u.filter(function(e,n){return e!==t}):u.length=0)}else n.clear()}fire(e,t){let n=o.get(this);n||u.log(arguments,this.id);let r=n.context,i=[...arguments],s=i.findIndex(function(e,t){return h.isArray(e)});s<0&&(s=i.length);let l=i.slice(0,s),a=n.tree.get(l),c=[];return a?(t=i[s]||[],a.count++,a.list.forEach(function(e,n){let i=e.apply(r,t);c.push(i)}),c):c}has(...e){let t=o.get(this).tree.get([...e]);return t&&t.list&&t.list.length>0}set(e,t){let n=o.get(this);switch(e){case"context":n[e]=t;break;default:throw new m("不支持设置属性: "+e)}}destroy(){o.get(this).tree.destroy(),o.delete(this)}}}),N("Object",function(e,t,n){t.exports=n={deepAssign:(e,...t)=>(t.forEach(t=>{e=function e(t,r){t=t||{};for(let i in r){let o=t[i],s=r[i];n.isPlain(s)&&(s=e(o=n.isPlain(o)?e({},o):{},s)),t[i]=s}return t}(e,t)}),e),isEmpty(e){for(let t in e)return!1;return!0},isPlain(e){if(!e||"object"!=typeof e)return!1;var t,n=j.prototype.hasOwnProperty,r=e.constructor;try{if(r&&!n.call(e,"constructor")&&!n.call(r.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return t===S||n.call(e,t)},flat(e){let t=n.isPlain,r=[];if(!e||!t(e))return r;let i=[];return function e(n,o){for(let s in n){let l=n[s];(i=i.slice(0,o)).push(s),t(l)?e(l,o+1):r.push({keys:i,value:l})}}(e,0),r},grep(e,t){let n={};for(let r in e){let i=e[r];!0===t(r,i)&&(n[r]=i)}return n},each(e,t,r){"boolean"!=typeof e&&(r=t,t=e,e=!1);for(let i in t){let o=t[i];if(!1===r(i,o,t))break;!0===e&&o&&"object"==typeof o&&n.each(!0,o,r)}},map(e,t,r){"boolean"!=typeof e&&(r=t,t=e,e=!1);let i=n.isPlain,o=n.map,s={};for(let n in t){let l=t[n];e&&i(l)?s[n]=o(!0,l,r):s[n]=r(n,l)}return s},make(e,t,n){if(h.isArray(e)&&(n=t,t=e,e={}),!e||"object"!=typeof e)throw new m("参数 obj 必须为一个非空的对象，以作为容器对象。");let r=e,i=t.length-1;return t.map(function(e,t){let o=r[e];t<i?r=r[e]="object"==typeof o&&o||{}:r[e]=n}),e},filter(e,t){let r={};if(h.isArray(t))t.forEach(function(t,n){t in e&&(r[t]=e[t])});else if(n.isPlain(t))n.each(t,function(t,n){t in e&&(r[t]=e[t])});else{if("string"!=typeof t)throw new m("无法识别参数 samples 的类型");{let n=t;n in e&&(r[n]=e[n])}}return r},delete(e,t){let n=j.assign({},e);if("string"==typeof t)delete n[t];else if(h.isArray(t))for(let e=0,r=t.length;e<r;e++)delete n[t[e]];else for(let e in t)delete n[e];return n}}}),N("Tree",function(e,t,n){const r=e("Object"),i=new b;function o(e,t){let n=t.length-1;for(let r=0;r<=n;r++){let i=e[t[r]];if(!i||r==n)return i||null;e=i.key$node}}class s{constructor(e){if(i.set(this,{key$node:{},count:0}),"object"==typeof e&&e){r.flat(e).forEach((e,t)=>{this.set(e.keys,e.value)})}}static from(e){return new s(e)}set(e,t){if(!h.isArray(e)){let n=[...arguments];e=n.slice(0,-1),t=n.slice(-1)[0]}let n=i.get(this),r=n.key$node,o=e.length-1,s=null;e.forEach(function(i,l){(s=r[i])||(n.count++,s=r[i]={key$node:{},parent:r,key:i,keys:e.slice(0,l+1)}),l<o?r=s.key$node:s.value=t})}get(e){h.isArray(e)||(e=[...arguments]);let t=o(i.get(this).key$node,e);return t?t.value:S}has(e){return!!o(i.get(this).key$node,e)}each(e,t){if("function"==typeof e)t=e,e=[];else if(!h.isArray(e)){let n=[...arguments];e=n.slice(0,-1),t=n.slice(-1)[0]}if("function"!=typeof t)throw new m("参数 fn 必须为一个函数。");let n=i.get(this).key$node;if(e.length>0){let t=o(n,e);if(!t)throw new m(`不存在路径为 ${e.join(".")} 的节点。`);n=t.key$node}!function e(t,n){for(let i in t){let o=t[i],s=o.key$node,l=!s||r.isEmpty(s);if(!1===n({key:i,value:o.value,keys:o.keys,isLeaf:l}))break;l||e(s,n)}}(n,t)}clear(){let e=i.get(this);e.key$node={},e.count=0}remove(e){h.isArray(e)||(e=[].slice.call(arguments));let t=i.get(this),n=o(t.key$node,e);if(!n)return;let s=n.key$node;!s||r.isEmpty(s)?(t.count--,delete n.parent[n.key]):delete n.value}destroy(){i.delete(this)}}t.exports=s}),N("Masker/Meta",function(e,t,n){const r=e("String");t.exports={create(e,t){let n=r.randomId("definejs-masker-",4),i=e.eventName,o=e.volatile,s={id:n,sample:"",eventName:i,volatile:o,container:e.container,duration:e.duration,fadeIn:e.fadeIn,fadeOut:e.fadeOut,opacity:e.opacity,emitter:null,style:null,this:null,$:null,bindVolatile(e){o&&("touch"==i?s.$.touch(e):s.$.on(i,e))}};return j.assign(s,t),s}}}),N("Masker/Sample",function(e,t,n){t.exports='<div id="{id}" class="definejs-masker" style="{style} display: none;"></div>'}),N("Masker/Style",function(e,t,n){const r=e("Object"),i=e("Style");t.exports={get(e){let t=r.filter(e,["opacity","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t)}}}),N("Masker.defaults",function(e,t,n){t.exports={volatile:!1,container:"body",eventName:"click",duration:0,fadeIn:0,fadeOut:0,cssClass:"",opacity:.5,"z-index":1024,style:{}}}),N("Masker",function(e,t,n){const r=e("jquery"),i=e("Emitter"),o=e("Object"),s=e("String"),l=e("Style"),a=t.require("Sample"),u=t.require("Style"),c=t.require("Meta"),d=new b;class h{constructor(e){e=o.deepAssign({},n.defaults,e);let t=new i(this),r=u.get(e),s=c.create(e,{sample:a,style:r,emitter:t,this:this});d.set(this,s),j.assign(this,{id:s.id})}render(){let e=d.get(this);if(e.$)return;let t=l.stringify(e.style),n=s.format(e.sample,{id:e.id,style:t});r(e.container).append(n),this.$=e.$=r(`#${e.id}`),e.bindVolatile(function(){if(!1===e.this.hide())return;let t=e.$.css("opacity");e.$.css("opacity",0),e.this.show({quiet:!0}),f(function(){e.$.css("opacity",t),e.$.hide()},200)}),e.emitter.fire("render")}show(e){e=e||{};let t=d.get(this),n="duration"in e?e.duration:t.duration,r="fadeIn"in e?e.fadeIn:t.fadeIn;t.$||this.render(),n&&f(function(){t.this.hide()},n),r&&t.$.css("opacity",0),t.$.show(),r&&t.$.animate({opacity:t.opacity},r),e.quiet||t.emitter.fire("show")}hide(e){e=e||{};let t=d.get(this),n="fadeOut"in e?e.fadeOut:t.fadeOut;if(t.$)return!t.emitter.fire("hide").includes(!1)&&void(n?t.$.animate({opacity:0},n,function(){t.$.css("opacity",t.opacity),t.$.hide()}):t.$.hide())}remove(){let e=d.get(this);if(!e.$)return;let t=e.$.get(0);t.parentNode.removeChild(t),e.$.off(),this.$=e.$=null,e.emitter.fire("remove")}on(...e){d.get(this).emitter.on(...e)}destroy(){let e=d.get(this);this.remove(),e.emitter.destroy(),d.delete(this)}static normalize(e,t){if(!1===t)return null;"number"==typeof e&&(e={opacity:e}),"number"==typeof t&&(t={opacity:t});let n=typeof e,r=typeof t;return"object"==n&&"object"==r?j.assign({},e,t):!0===t?e&&"object"==n?e:{}:t===S?"object"==n?e:e?{}:null:"object"==r?t:t?{}:null}}h.defaults=e("Masker.defaults"),t.exports=n=h}),N("String",function(e,t,n){t.exports=n={format(e,t){let r=e,i=n.replaceAll,o=(e,t,n)=>(h.isArray(n)&&(n=n.join("")),e=i(e,`{${t}}`,n));if("object"==typeof t)for(let e in t)r=o(r,e,t[e]);else{[...arguments].slice(1).forEach(function(e,t){r=o(r,e,t)})}return r},replaceAll:(e,t,n)=>e.split(t).join(n),replaceBetween(e,t,n,r){if("object"==typeof t){let e=t;t=e.begin,n=e.end,r=e.value}if(e.indexOf(t)<0||e.indexOf(n)<0)return e;return e=e.split(t).map(function(e){let t=e.split(n);return 1==t.length?t[0]:r+t.slice(1).join(n)}).join("")},padLeft(e,t,n){let r=(e=C(e)).length;if(t<=r)return e.substr(-t);n=n||" ";let i=[];return i.length=t-r+1,i.join(n)+e},padRight(e,t,n){let r=C(e),i=r.length;if(i>=t)return r.substring(0,t);n=n||" ";let o=[];return o.length=t-i+1,r+o.join(n)},between(e,t,n){let r=e.indexOf(t);if(r<0)return"";r+=t.length;let i=e.indexOf(n,r);return i<0?"":e.substr(r,i-r)},random(e){if(e===S&&(e=12),"number"==typeof e){let t=e+1;t<0&&(t=0),(e=[]).length=t,e=e.join("x")}return e.replace(/x/g,function(e){return(16*v.random()|0).toString(16)}).toUpperCase()},randomId:(...e)=>(e=e.map(function(e,t){return"number"==typeof e&&(e=(e=n.random(e)).toLowerCase()),e})).join(""),toCamelCase:e=>e.replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/gi,function(e,t){return t.toString().toUpperCase()}),toHyphenate:e=>e.replace(/[A-Z]/g,function(e){return"-"+e.charAt(0).toLowerCase()}),toUtf8(e){let t=[];return e.split("").forEach(function(e,n){let r=e.charCodeAt(0);r<128?t.push(r):r<2048?(t.push((1984&r)>>6|192),t.push(63&r|128)):(t.push((61440&r)>>12|224),t.push((4032&r)>>6|128),t.push(63&r|128))}),"%"+(t=t.map(function(e,t){return e.toString(16)})).join("%")},toValue(e){if("string"!=typeof e)return e;let t={true:!0,false:!1,null:null,undefined:S,NaN:NaN};return e in t?t[e]:e},split(e,t){let n=C(e).split(t[0]);for(let e=1,i=t.length;e<i;e++)n=r(n,t[e],e);return n;function r(e,t,n){return n--,e.map(function(e,i){return 0==n?C(e).split(t):r(e,t,n)})}},getByteLength:e=>e?e.toString().replace(/[\u0100-\uffff]/g,"  ").length:0}}),N("Style",function(e,t,n){const r=e("Object");function i(e){if("number"==typeof e)return e+"px";if("string"==typeof e){let t=/^\d+px$/g.test(e),n=/^\d+em$/g.test(e),r=/^\d+rem$/g.test(e),i=/^\d+%$/g.test(e);if(t||n||r||i)return e;let o=parseInt(e);return isNaN(o)?e:o+"px"}return e}t.exports=n={objectify(e){if(!e)return{};if("object"==typeof e)return e;if("string"!=typeof e)return{};let t={};return e.split(";").forEach(function(e){if(!(e=(e=e.trim()).replace(/\n/g,"")))return;let n=e.split(":"),r=n[0].trim(),i=n[1].trim();t[r]=i}),t},stringify(e,t,i){if(!e)return"";"string"==typeof e&&(e=n.objectify(e)),"number"==typeof t&&(i=t,t=null);let o=[];return r.each(e,function(e,n){if(null==(n=t?t(e,n):n)||""===n)return;let r=e+": "+n;i&&(r=new h(i+1).join(" ")+r),o.push(r)}),0==o.length?"":e=i?o.join("; \n")+"; \n":o.join("; ")+"; "},pixelize:(e,t)=>"object"==typeof e||t?(t=t||[],e=n.objectify(e),e=r.map(e,function(e,n){return t.includes(e)?i(n):n})):i(e),trim(e){let t={};return r.each(e,function(e,n){null!=n&&""!==n&&(t[e]=n)}),t},merge:(...e)=>(e=e.map(function(e){return e?e=n.trim(e):{}}),j.assign(...e))}}),N("Template/Parser/Templates",function(e,t,n){t.exports={get(e){let t=e.getElementsByTagName("template"),n=new b;return t.map(function(e){let t=e.attributes,r=e.innerHTML,i={id:e.id||"",name:e.name||"",placeholder:t.placeholder||"",innerHTML:r,outerHTML:e.outerHTML,node:e,sample:r,parent:null,attributes:t,items:[]};return n.set(e,i),i}).filter(function(e){let t=function(e){for(e=e.parentNode;e;){if("template"==e.nodeName)return e;e=e.parentNode}return null}(e.node),r=n.get(t);if(!r)return!0;e.parent=r,r.items.push(e);let i=r.sample,o=e.outerHTML,s=e.placeholder;s&&(s="{"+s+"}"),r.sample=i.replace(o,s)})}}}),N("Template/Child",function(e,t,n){t.exports={create(e,t,n){let r=n.name;if(t.name$tpl[r])throw new m("同一级下已存在名为 `"+r+"` 的模板。");let i=new e(n);return t.name$tpl[r]=i,t.parent=t.this,i.parent=t.this,i.on("process",function(...e){t.emitter.fire("process",e)}),i}}}),N("Template/Meta",function(e,t,n){const r=e("String");function i(e){return e}t.exports={create(e){let t={id:r.randomId("definejs-template-",4),sample:"",name:"",placeholder:"",innerHTML:"",outerHTML:"",tpls:[],name$tpl:{},node:null,parent:null,emitter:null,this:null,process:i};return j.assign(t,e),t},assign(e,t){j.assign(e,{sample:t.sample,name:t.name,placeholder:t.placeholder,innerHTML:t.innerHTML,outerHTML:t.outerHTML,node:t.node})}}}),N("Template/Parser",function(e,t,n){const r=e("HTMLParser"),i=t.require("Templates");t.exports={parse(e){let t=r.parse(e);return{dom:t,tpls:i.get(t)}}}}),N("Template/Sample",function(e,t,n){const r=e("String"),i={begin:'<script type="text/template">',end:"<\/script>"},o={begin:"\x3c!--",end:"--\x3e"};t.exports=n={replace(e,t){let{outerHTML:r,placeholder:i}=t;return i&&(i="{"+i+"}"),e=(e=n.removeScript(e)).replace(r,i)},betweenComment(e){let{begin:t,end:n}=o;return e.includes(t)&&e.includes(n)&&(e=r.between(e,t,n)),e},removeScript(e){let{begin:t,end:n}=i;return e.includes(t)&&e.includes(n)&&(e=(e=e.split(t).join("")).split(n).join("")),e}}}),N("Template",function(e,t,n){const r=e("jquery"),i=e("String"),o=e("Object"),s=e("Emitter"),l=e("HTMLParser"),a=t.require("Meta"),c=t.require("Parser"),f=t.require("Sample"),d=t.require("Child"),p=new b;class g{constructor(e){let t=o.isPlain(e),n=a.create({emitter:new s(this),this:this});if(p.set(this,n),t){let t=e;a.assign(n,t),n.tpls=t.items.map(function(e){return d.create(g,n,e)})}else{let t=r(e).get(0);if(!t)throw e=e instanceof r?e.selector:e,new m("不存在模板节点: "+e);let i="template"==t.nodeName.toLowerCase(),o=f.removeScript(t.innerHTML),s=c.parse(o);n.sample=f.betweenComment(o),n.name=i?t.getAttribute("name"):"",n.placeholder=i?t.getAttribute("placeholder"):"",n.innerHTML=o,n.outerHTML=t.outerHTML,n.node=t,n.tpls=s.tpls.map(function(e){let t=d.create(g,n,e),r=n.sample;return n.sample=f.replace(r,e),t})}!function(){let e=n.name$tpl[""];if(!e)return;let t=p.get(e);if(j.keys(t.name$tpl).length>0)throw new m("无名称的 template 标签下不能再嵌套子级 template。");if(t.placeholder)throw new m("无名称的 template 标签不能设置 placeholder 属性。");n.sample=t.sample}(),j.assign(this,{id:n.id,_meta:n})}template(e){h.isArray(e)||(e=[...arguments]);let t=this,n=p.get(t);return e.map(function(e){t=n.name$tpl[e],n=p.get(t)}),t}sample(...e){let t=this.template(...e),n=p.get(t);if(!n)throw new m(`当前实例下不存在名称路径为 ${e.join(" ")} 的 Template 子实例。`);return n.sample}render(e,t){t&&this.process(t);let n=p.get(this).node,r=this.fill(e);return n&&(n.innerHTML=r),r}fill(e,...t){let n=[...arguments],r=n.findIndex(function(e){return h.isArray(e)||o.isPlain(e)});if(r<0)throw new m("填充模板时必须指定数据为一个数组或纯对象。");if(r>0){let e=n.slice(0,r),t=this.template(...e);if(!t)throw new m(`不存在路径为 ${e.join(".")} 的模板节点，请检查 html 模板树。`);let i=n.slice(r);return t.fill(...i)}let s=p.get(this);if(!h.isArray(e)){if(s.emitter.fire("process",n),"string"==typeof(e=s.process.apply(s.this,n)))return e;return i.format(s.sample,e)}return e.map(function(e,n){let r=[e,n,...t];s.emitter.fire("process",r);let o=s.process.apply(s.this,r);return"string"==typeof o?o:o?i.format(s.sample,o):""}).join("")}process(e){let t=p.get(this);if("function"==typeof e)return void(t.process=e);let n=[...arguments],r=n.findIndex(function(e){return"function"==typeof e||o.isPlain(e)});if(r<0)throw new m(`模板节点 ${t.name} 缺少处理器。`);if(r>0){let t=n.slice(0,r),i=n[r];e=o.make({},t,i)}o.flat(e).forEach(function(e){let n=e.keys.filter(function(e){return!!e}),r=e.value;if("function"!=typeof r)throw new m(`模板节点 ${n.join(".")} 的处理器必须为一个函数。`);let i=t.this.template(n);i?i.process(r):u.warn(`不存在模板节点: ${n.join(".")}`)})}fix(e){let t=p.get(this),n=t.sample;(e=h.isArray(e)?e:[e]).map(function(e){let t="{"+e+"}",r=t+'=""';n=n.split(r).join(t)}),t.sample=n}on(...e){p.get(this).emitter.on(...e)}destroy(){let e=p.get(this);e&&(e.tpls.map(function(e){e.destroy()}),e.emitter.destroy(),e.node=null,e.parent=null,e.emitter=null,p.delete(this))}static create(e){e=`<template>${e}</template>`;let t=l.parse(e);return new g(t.childNodes[0])}}t.exports=g}),N("HTMLParser",function(e,t,n){t.exports=function(){var e={},t={},n=/([a-z0-9_\:\-]*)\s*?=\s*?(['"]?)(.*?)\2\s+/gim,r=/(?:<(\/?)([a-zA-Z][a-zA-Z0-9\:]*)(?:\s([^>]*?))?((?:\s*\/)?)>|(<\!\-\-)([\s\S]*?)(\-\->)|(<\!\[CDATA\[)([\s\S]*?)(\]\]>))/gm;function o(){this.childNodes=[]}function s(){}function l(){o.call(this)}function a(){}function c(){}function f(){}return t.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},t.inherit=function(e,n){var r=e.prototype;function i(){}i.prototype=n.prototype,e.prototype=new i,t.extend(e.prototype,r),e.prototype.constructor=e},t.selfClosingTags=["area","base","br","col","embed","frame","hr","img","input","keygen","link","meta","object","param","source"],t.getElementsByTagName=function(e,n){var r,i,o=[],s=0;if(n||(n="*"),n=n.toLowerCase(),e.childNodes)for(r=0;r<e.childNodes.length;r++)1!==(i=e.childNodes[r]).nodeType||"*"!==n&&i.nodeName!==n||(o[s++]=i),h.prototype.splice.apply(o,[o.length,0].concat(t.getElementsByTagName(i,n))),s=o.length;return o},t.splitAttrs=function(e){var t,r={};if(e)for(n.lastIndex=0,e=" "+(e||"")+" ";t=n.exec(e);)r[t[1]]=t[3];return r},t.ta=i.createElement("textarea"),t.encodeEntities=function(e){return t.ta.value=e||"",t.ta.innerHTML},t.decodeEntities=function(e){return t.ta.innerHTML=e||"",t.ta.value},t.htmlToText=function(e){return e=e.replace(/<\/?[a-z].*?>/gim,""),t.decodeEntities(e)},t.extend(o.prototype,{nodeType:1,textContent:"",getElementsByTagName:function(e){return t.getElementsByTagName(this,e)},getAttribute:function(e){if(this.attributes.hasOwnProperty(e))return this.attributes[e]},setAttribute:function(e,t){var n=(e+"").toLowerCase();this.attributes[e]=t+"","id"!==n&&"name"!==n||(this[n]=t),"class"===n&&(this.className=t)},getElementById:function(e){var t,n=this.getElementsByTagName("*");for(t=n.length;t--;)if(n[t].id===e)return n[t]},appendChild:function(e){e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e)},insertBefore:function(e,t){e.parentNode&&e.parentNode.removeChild(e);for(var n=0;n<this.childNodes.length&&this.childNodes[n]!==t;n++);this.childNodes.splice(n,0,e)},removeChild:function(e){for(var t=this.childNodes.length;t--;)if(this.childNodes[t]===e){this.childNodes.splice(t,1);break}}}),e.HTMLElement=o,t.extend(s.prototype,{toString:function(){return this.textContent}}),t.inherit(l,o),t.extend(l.prototype,{nodeType:9,nodeName:"#document"}),e.Document=l,t.inherit(a,s),t.extend(a.prototype,{nodeType:3,nodeName:"#text"}),e.TextNode=a,t.inherit(c,s),t.extend(c.prototype,{nodeType:8,nodeName:"#comment"}),e.CommentNode=c,t.inherit(f,s),t.extend(f.prototype,{nodeType:4,nodeName:"#cdata-section"}),e.CDATASectionNode=f,t.blockConstructors={"\x3c!--":c,"<![CDATA[":f},e.parse=function(e){var n,i,s,c,f,d,h,p,g,m,y,w,b;for(n=[],r.lastIndex=0,s=i=new l,w=function(){s&&n.length>0&&(c=n[n.length-1],h=(c.documentPosition.closeTag||c.documentPosition.openTag).end,c.parentNode===s&&h&&h<b.documentPosition.openTag.start&&(d=e.substring(h,b.documentPosition.openTag.start))&&(d=t.decodeEntities(d),s.childNodes.push(t.extend(new a,{textContent:d,nodeValue:d,parentNode:s}))))};f=r.exec(e);)p=f[5]||f[8],g=f[6]||f[9],m=f[7]||f[10],"\x3c!--"===p||"<![CDATA["===p?(h=r.lastIndex-f[0].length,(y=t.blockConstructors[p])&&(b=t.extend(new y,{textContent:g,nodeValue:g,parentNode:s,documentPosition:{openTag:{start:h,end:h+p.length},closeTag:{start:r.lastIndex-m.length,end:r.lastIndex}}}),w(),n.push(b),b.parentNode.childNodes.push(b))):"/"!==f[1]?((b=t.extend(new o,{nodeName:(f[2]+"").toLowerCase(),attributes:t.splitAttrs(f[3]),parentNode:s,documentPosition:{openTag:{start:r.lastIndex-f[0].length,end:r.lastIndex}}})).className=b.attributes.class,b.id=b.attributes.id,b.name=b.attributes.name,w(),n.push(b),b.parentNode.childNodes.push(b),f[4]&&f[4].indexOf("/")>-1||t.selfClosingTags.includes(b.nodeName)?(b.documentPosition.closeTag=b.documentPosition.openTag,b.isSelfClosingTag=!0,b.innerHTML="",b.outerHTML=e.substring(b.documentPosition.openTag.start,b.documentPosition.closeTag.end)):s=b):(f[2]+"").toLowerCase()===s.nodeName?(s=(b=s).parentNode,delete b.isSelfClosingTag,b.documentPosition.closeTag={start:r.lastIndex-f[0].length,end:r.lastIndex},b.innerHTML=e.substring(b.documentPosition.openTag.end,b.documentPosition.closeTag.start),b.outerHTML=e.substring(b.documentPosition.openTag.start,b.documentPosition.closeTag.end),b.textContent=t.htmlToText(b.innerHTML)):(f[2]+"").toLowerCase()===n[n.length-1].nodeName&&!0===n[n.length-1].isSelfClosingTag?(b=n[n.length-1],u.warn("HTML Error: discarding dangling </"+f[2]+"> tag. Already closed via: "+b.outerHTML),delete b.isSelfClosing,b.documentPosition.closeTag={start:r.lastIndex-f[0].length,end:r.lastIndex}):u.warn('tag mismatch: "'+f[2]+'" vs "'+b.nodeName+'"',b);return i.documentElement=i.getElementsByTagName("html")[0],i.body=i.getElementsByTagName("body")[0],i},e}()}),N("API/Ajax",function(e,t,n){const r=e("Object"),i=e("String"),o=e("JSON"),s=e("Proxy"),l=e("Query");function a(e,t){let n=t.proxy;if(n)return s.request(n,t),null;let a=[t.url,t.prefix,t.name,t.ext].join(""),u=t.data||null;if(u){let e=t.serialize;u=r.map(u,function(t,n){return"object"==typeof n&&n?e(t,n):n})}if("post"==e){let e=t.query;e&&(a=l.add(a,e)),u&&(u=l.stringify(u))}else u&&(a=l.add(a,u),u=null);let c=t.random;c&&(c=i.random(4),a=l.add(a,c));let d=!1,h=null,p=t.timeout||0;p>0&&(h=f(function(){d=!0,g.abort();let e=t.ontimeout;e&&e(g)},p));let g=new XMLHttpRequest;g.open(e,a,!0),g.onreadystatechange=function(){if(d||4!=g.readyState)return;clearTimeout(h);let e=t.successCode,n=t.error,r=t.success,i=t.fail,s=t.field||null;if(200!=g.status)return void(n&&n(g));if(!s)return void(r&&r(g));let l=o.parse(g.responseText);if(!l)return void(n&&n(g));let a=l[s.code];if(a==e){let e=s.data in l?l[s.data]:{};r&&r(e,l,g)}else{let e=l[s.msg];i&&i(a,e,l,g)}};let m=t.headers;return m&&r.each(m,function(e,t){g.setRequestHeader(e,t)}),"post"==e&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.send(u),g}t.exports={get:e=>a("get",e),post:e=>a("post",e)}}),N("API.defaults",function(e,t,n){t.exports={type:"json",successCode:200,field:{code:"code",msg:"msg",data:"data"},proxy:null,delay:!1,random:!0,url:"",prefix:"",ext:"",data:null,query:null,headers:null,timeout:0,serialize:function(e,t){let n=w.stringify(t);return encodeURIComponent(n)},get:null,post:null}}),N("API",function(e,t,n){const r=e("Object"),i=e("Emitter"),o=e("Fn"),s=t.require("Ajax"),l=new b;class a{constructor(e,t){"object"==typeof e&&(t=e,e=""),e=e||"",t=r.deepAssign({},n.defaults,t);let a=new i(this),u=t.successCode,c=t.proxy;switch(c){case!0:c=e+".js";break;case".json":case".js":c=e+c}let f={ajax:{name:e,data:t.data,query:t.query,url:t.url,prefix:t.prefix,ext:t.ext,random:t.random,successCode:u,field:t.field,proxy:c,serialize:t.serialize,timeout:t.timeout,headers:t.headers,success(e,t,n){d("success",[e,t,n])},fail(e,t,n,r){d("fail",[e,t,n,r])},error(e){f.aborted?f.aborted=!1:d("error",[e])},ontimeout(e){d("timeout",[e])}},status:"",args:[],emitter:a,xhr:null,aborted:!1,fireEvent:d,get:t.get||s.get,post:t.post||s.post};function d(e,n,r){e=f.status=e||f.status,n=f.args=n||f.args,r=r||f.emitter,f.xhr=null;let i=n.length,s=n[i-1],l=n[i-2],a="success"==e,c="fail"==e;o.delay(t.delay,function(){let t=r.fire("response",[e,l,s]);if(!t.includes(!1)){if(a||c){let e=a?u:n[0];if((t=r.fire("code",e,n)).includes(!1))return}s&&(t=r.fire("status",s.status,n)).includes(!1)||(t=r.fire(e,n)).includes(!1)||r.fire("done",[e,l,s])}})}l.set(this,f)}get(e){let t=l.get(this),n=t.emitter;t.aborted=!1;let r=j.assign({},t.ajax);e&&(r.data=e),e=r.data,n.fire("request","get",[e]),n.fire("request",["get",e]),t.xhr=t.get(r)}post(e,t){let n=l.get(this),r=n.emitter,i=n.ajax;n.aborted=!1;let o=j.assign({},i,{data:e||i.data,query:t||i.query});e=o.data,t=o.query,r.fire("request","post",[e,t]),r.fire("request",["post",e,t]),n.xhr=n.post(o)}abort(){let e=l.get(this),t=e.xhr;t&&(e.aborted=!0,t.abort(),e.emitter.fire("abort"))}on(...e){let t=l.get(this),n=t.emitter,r=t.status;if(n.on(...e),r){let n=new i(this);n.on.apply(n,e),t.fireEvent(r,t.args,n),n.destroy()}}destroy(){l.get(this).emitter.destroy(),l.delete(this)}}a.defaults=e("API.defaults"),t.exports=n=a}),N("Fn",function(e,t,n){const r=e("Math");t.exports={noop:(...e)=>e[0],delay(e,t,n){if(!t)return;if(!1===e||null==e)return void t.apply(null,n);let i="number"==typeof e?e:r.randomInt(e.min,e.max);return f(function(){t.apply(null,n)},i)},exec:e=>new y(`\n                return (function () { \n                    ${e}\n                })();\n            `)()}}),N("Math",function(e,t,n){t.exports=n={randomInt(e,t){let n=arguments.length;if(0==n)return x(C(v.random()).replace(".","").replace(/^0*/g,""));1==n&&(t=e,e=0);let r=t-e+1;return v.floor(v.random()*r+e)},slide:(e,t,n)=>(e+=n=n||1)>=0?e%t:(t-v.abs(e)%t)%t,next:(e,t)=>n.slide(e,t,1),previous:(e,t)=>n.slide(e,t,-1),parsePercent(e){if("string"!=typeof e)return e;let t=e.trim();return"%"!=t.slide(-1)?e:parseFloat(t)/100}}}),N("JSON",function(e,t,n){t.exports={parse(e){try{return w.parse(e)}catch(e){u.warn("使用原生的 JSON.parse() 方法无法解析。")}try{let t=["return (function () { ","   var obj = "+e+";","   return obj;","})();"].join("\r\n");return new y(t)()}catch(e){u.warn("使用 new Function() 方法无法解析。")}return null},stringify:(...e)=>w.stringify(...e)}}),N("Proxy/Url",function(e,t,n){const r=e("Url"),i=e("Query");t.exports={get:(e,t)=>(e=function(e,t){if(r.isFull(e))return e;if(r.isFull(t))return t+e;let n=r.root();return"/"!=e.slice(0,1)&&(n+=t),n+e}(e,t),e=i.random(e))}}),N("Proxy.defaults",function(e,t,n){t.exports={base:"",delay:{min:500,max:3e3}}}),N("Proxy",function(e,t,n){const r=e("Url"),i=e("JSON"),o=e("Fn"),s=e("Script"),l=t.require("Url");let a=null;function u(e,...t){let r=n.defaults.delay;o.delay(r,e,t)}function c(e,t){if(!e)return void u(t.error);let n=t.successCode,r=t.field,i=e[r.code];if(i==n){let n=e[r.data]||{};u(t.success,n,e)}else{let n=e[r.msg]||"";u(t.fail,i,n,e)}}t.exports=n={defaults:e("Proxy.defaults"),request(e,t){if(r.isExt(e,".js"))!function(e,t){let r=n.defaults.base,i=l.get(e,r);s.load(i,function(){let e=a;a=null,"function"==typeof e&&(e=e(t.data,t)),c(e,t)})}(e,t);else{if(!r.isExt(e,".json"))throw new m("不支持参数 file 的文件类型: "+e);!function(e,t){let r=n.defaults.base,o=l.get(e,r),s=new XMLHttpRequest;s.open("get",o,!0),s.onreadystatechange=function(){4==s.readyState&&(200==s.status?c(i.parse(s.responseText),t):u(t.error))},s.send(null)}(e,t)}},response(e){a=e}}}),N("Query",function(e,t,n){const r=e("Object"),i=e("String");function o(e,t){"object"==typeof(t=t||"")&&(t=n.stringify(t)),t&&(t="?"+t);var r=e.includes("?"),i=e.includes("#"),o=[];return r&&i?(o=e.split(/\?|#/g))[0]+t+"#"+o[2]:r?(o=e.split("?"))[0]+t:i?(o=e.split("#"))[0]+t+"#"+o[1]:e+t}t.exports=n={parse(e,t,r){if(!e||"string"!=typeof e)return{};var o=r?unescape:decodeURIComponent,s=!t;const l=i.toValue;var a={};return e.split("&").map(function(e){var t=e.split("="),r=o(t[0]),i=t[1];if(t.length>1&&(i=o(i),i=s&&i.indexOf("=")>0?n.parse(i):l(i)),r in a){var u=a[r];h.isArray(u)?u.push(i):a[r]=[u,i]}else a[r]=i}),a},stringify(e,t){if(null==e)return C(e);switch(typeof e){case"string":case"number":case"boolean":return e}if(e instanceof C||e instanceof x||e instanceof p||e instanceof g)return e.valueOf();if(h.isArray(e))return"["+e.join(", ")+"]";let i=t?escape:encodeURIComponent,o=[];return r.each(e,function(e,t){e=i(e),t!==S?(t=n.stringify(t),t=i(t),o.push(`${e}=${t}`)):o.push(e)}),o.join("&")},get(e,t,r){"object"==typeof e&&(e="href"in e?e.href:e.location.href);let i=e.indexOf("?");if(i<0)return;let o=e.indexOf("#");o<0&&(o=e.length);let s=e.slice(i+1,o);if(""===t)return decodeURIComponent(s);let l=n.parse(s);if(t===S)return l;if(!r||t in l)return l[t];t=t.toString().toLowerCase();for(let e in l)if(e.toLowerCase()==t)return l[e]},add(e,t,r){var i=n.get(e)||{};"object"==typeof t?j.assign(i,t):i[t]=r;var o={};for(let e in i){let t=i[e];null!==t&&(o[e]=t)}return n.set(e,o)},remove(e,t){let r=null;"object"==typeof e&&(e=(r="href"in e?e:e.location).href);let i="";return t&&delete(i=n.get(e))[t],e=o(e,i),r&&(r.href=e),e},random(e,t){var r=i.random(t);return n.add(e,r,S)},set(e,t,n){var r=null;"object"==typeof e&&(e=(r="href"in e?e:e.location).href);var i=typeof t,s=/^(string|number|boolean)$/.test(i);return e=o(e,2==arguments.length&&s?encodeURIComponent(t):"object"==i?t:{[t]:n}),r&&(r.href=e),e},has(e,t,i){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var o=n.get(e);if(!o)return!1;if(!t)return!r.isEmpty(o);if(t in o)return!0;if(i){t=t.toString().toLowerCase();for(let e in o)if(e.toLowerCase()==t)return!0}return!1},escape(e){var t=C(e);return escape(t).replace(/\+/g,"%2B")}}}),N("Script.defaults",function(e,t,n){t.exports={url:"",id:"",charset:"utf-8",document:r.document,onload:null}}),N("Script",function(e,t,n){const r=e("Object");function i(e,t,n,r){let i;if("object"==typeof e){let o=e;i=o.id,e=o.url,t=o.charset,n=o.document,r=o.onload}let o=n.createElement("script");r&&(o.readyState?o.onreadystatechange=function(){let e=o.readyState;"loaded"!=e&&"complete"!=e||(o.onreadystatechange=null,r())}:o.onload=r),o.src=e,t&&(o.charset=t),i&&(o.id=i),n.head.appendChild(o)}t.exports=n={defaults:e("Script.defaults"),load(e){let t={...n.defaults};if(r.isPlain(e))j.assign(t,e);else{switch(t.url=e,typeof arguments[1]){case"string":t.charset=arguments[1];break;case"object":t.document=arguments[1];break;case"function":t.onload=arguments[1]}switch(typeof arguments[2]){case"object":t.document=arguments[2];break;case"function":t.onload=arguments[2]}arguments[3]&&(t.onload=arguments[3])}let o=t.url;if("string"==typeof o)i(t);else{if(!h.isArray(o))throw new m("参数 opt.url 必须为 string 或 string 的数组");!function(e,t,n,r){if(0==e.length)return void(r&&r());let o=0;!function s(){i(e[o],t,n,function(){++o<e.length?s():r&&r()})}()}(o,t.charset,t.document,t.onload)}}}}),N("Url.defaults",function(e,t,n){t.exports={root:()=>`${o.protocol}//${o.host}${o.pathname.split("/").slice(0,-1).join("/")}/`}}),N("Url",function(e,t,n){t.exports=n={defaults:e("Url.defaults"),root(){let e=n.defaults.root;return"function"==typeof e&&(e=e()),e.endsWith("/")||(e+="/"),e},main:e=>e=(e=e.split("#")[0]).split("?")[0],isFull:e=>"string"==typeof e&&(e.startsWith("http://")||e.startsWith("https://")),isExt:(e,t)=>"string"==typeof e&&"string"==typeof t&&(e=n.main(e)).slice(0-t.length).toLowerCase()==t.toLowerCase(),resolve(e){var t=arguments.length;if(0==t)throw new m("resolveUrl requires at least one argument; got none.");var n=i.createElement("base");if(n.href=e,1==t)return n.href;var r=i.head;r.insertBefore(n,r.firstChild);for(var o="",s=i.createElement("a"),l=1;l<t;l++)s.href=arguments[l],o=s.href,n.href=o;return r.removeChild(n),o}}}),N("App/Navigator/Views",function(e,t,n){const r=e("jquery"),i=e("Tasker"),o=e("Package"),s={};t.exports={load(e,t,n){let l=function(e){let t=[];return(h.isArray(e)?e:[e]).forEach((e,n)=>{e&&("string"==typeof e&&(e={view:e,args:[]}),t.push(e))}),t}(e),a=t.module,u=t.container,c=new i(l);c.on("each",function(e,t,n){let i=e.view,l=a.require(i);l?n(l):o.load(i,function(e){if(!e)throw new m(`总包中不存在名为 ${i} 的配置节点。`);let t=(e.html||{}).content;!s[i]&&u&&t&&(s[i]=!0,r(u).append(t));let o=a.require(i);if(!o)throw new m(`不存在名为 ${i} 的视图模块`);n(o)})}),c.on("all",function(e){n&&n(...e)}),c.parallel()}}}),N("App/Navigator",function(e,t,n){const r=e("Navigator"),i=t.require("Views");t.exports={create(e){let t=e.ViewSlider,n=e.animate,o=e.slide;if(n&&!t)throw new m("指定了参数 animate 为 true，必须提供 ViewSlider 以启用视图切换的动画效果（仅针对移动端）。");if(o&&!t)throw new m("指定了参数 slide 为 true，必须提供 ViewSlider 以启用滑动返回手势支持（仅针对移动端）。");let s=e.module,l=new r(e.id),a=()=>{l.back(!1)};return l.on("view",function(t,n,r){i.load(t,e,function(e){r.cache&&e.rendered()?e.show():e.render(...n)})}),e.preload&&l.on("immediate",function(n,r){let l=j.keys(r).map(function(e){return r[e]});l=l.sort(function(e,t){return e.timestamp>t.timestamp?-1:1}),i.load(l,e,function(){o&&l.slice(0,-1).forEach(function(e,n){let r=l[n+1],i=r.args;e=s.require(e.view),r=s.require(r.view),t.slide(e,r,{args:i,back:a})})})}),o&&l.on("to",function(n,r,o){n=s.require(n),i.load(r,e,function(e){t.slide(e,n,{back:a})})}),l.on("forward",function(r,o){r=s.require(r),i.load(o,e,function(e){n?t.forward(r,e):(r.hide(),e.show())})}),l.on("back",function(r,o){r=s.require(r),i.load(o,e,function(e){n?t.back(r,e):(r.hide(),e.show())})}),l}}}),N("App/Router",function(e,t,n){const r=e("Object"),i={};t.exports={set(e,t){if(i[e])throw new m(`重复定义的路由器: ${e}`);i[e]=t},bind(e,t,n){let o=r.map(i,function(r,i){return"function"==typeof i&&(i=i(e,t,n)),i});return t.bind(o),o}}}),N("App.defaults",function(e,t,n){t.exports={ViewSlider:null,root:"",name:"",seperator:"/",navigator:"app-default-navigator",view:{}}}),N("App",function(e,t,n){const r=e("SessionStorage"),i=e("LocalStorage"),o=e("AppModule"),s=t.require("Navigator"),l=t.require("Router");t.exports=n={defaults:e("App.defaults"),launch(e){const t=n.defaults,{name:a,root:u,seperator:c,navigator:f,view:d}=t;if(!a)throw new m("必须首先给应用分配一个唯一的名称，用于在存储中与其它应用区分开。");if("string"!=typeof u)throw new m("应用的顶级模块名称必须为一个 string。");if(u.includes(c))throw new m("应用的顶级模块名称不能含有父子模块的分隔符: "+c);r.defaults.name=a,i.defaults.name=a,j.assign(o.defaults,{seperator:c}),o.define(u,function(n,r,i){f&&(i=s.create({ViewSlider:t.ViewSlider,id:f,module:r,container:d.container,preload:d.preload,slide:d.slide,animate:d.animate})),l.bind(n,r,i),e&&e(n,r,i)}),o.require(u)},route:l.set}}),N("AppModule.defaults",function(e,t,n){const r=e("Emitter");t.exports={Emitter:r,seperator:"/",repeated:!1,cross:!1}}),N("AppModule",function(e,t,n){const r=e("ModuleManager"),i=e("Object"),o=e("String");let s={},l=null;function a(){return l||(l=new r(n.defaults)),l}t.exports=n={defaults:e("AppModule.defaults"),mm:a,define(e,t){e.includes("{")&&e.includes("}")?s[e]=t:a().define(e,t)},require:(...e)=>a().require(...e),on:(...e)=>a().on(...e),has:(...e)=>a().has(...e),data(e,t){if(h.isArray(e)){return e.forEach(e=>{a().data(e,t)}),t}if(i.isPlain(e)){let t=e;return i.each(t,function(e,t){a().data(e,t)}),t}return a().data(e,t)},fill(e,t){i.each(s,function(n,r){n.startsWith(e)&&(n=o.format(n,t),u.log(`动态定义模块: ${n}`),a().define(n,r))})}},n.define.has=n.has}),N("LocalStorage/Storage",function(e,t,n){const i=e("circular-json"),o=r.localStorage,s="@definejs/local-storage";let l=o.getItem(s)||"{}",a=i.parse(l)||{};function u(){l=i.stringify(a),o.setItem(s,l)}t.exports={set(e,t){a[e]=t,u()},get:e=>a[e],remove(e){delete a[e],u()},clear(){a={},u()}}}),N("LocalStorage.defaults",function(e,t,n){t.exports={name:""}}),N("LocalStorage",function(e,t,n){const r=e("Object"),i=t.require("Storage"),o=new b;class s{constructor(e,t){let i=(t=r.deepAssign({},n.defaults,t)).name;if(!i)throw new m("@definejs/local-storage 是针对多个应用的存储，每个应用都有自己独立的存储空间。\n                    请先指定所在应用的名称(通过配置 @definejs/local-storage.defaults 模块的 name 字段) 。");let s={name:i,id:e};o.set(this,s)}set(e,t){let n=o.get(this),r=i.get(n.name)||{},s=r[n.id]||{};"object"==typeof e?j.assign(s,e):s[e]=t,r[n.id]=s,i.set(n.name,r)}get(e){let t=o.get(this),n=(i.get(t.name)||{})[t.id];if(n)return 0==arguments.length?n:n[e]}remove(e){let t=o.get(this),n=i.get(t.name)||{},r=n[t.id];r&&(delete r[e],i.set(t.name,n))}clear(){let e=o.get(this),t=i.get(e.name);t&&(delete t[e.id],i.set(e.name,t))}}s.defaults=e("LocalStorage.defaults"),t.exports=n=s}),N("Navigator/Back",function(e,t,n){t.exports={getOffset(e,t){if(!t)return-1;let n=typeof t;if("number"==n){if(t<0)throw new m("要回退的步数(参数 target) 如果指定为数字时，只能是正数。");return 0-(t||1)}if("string"!=n)throw new m("要回退的目标视图(参数 target) 只能是 number 或 string 类型。");let r=e.hash$info[e.hash];if(!r)throw new m("当前视图为空，无法回退。");let i=e.this.get(),o=r.view,s=-1,l=-1;if(i.forEach(function(e,n){let r=e.view;r==t&&(s=n),r==o&&(l=n)}),s<0)throw new m(`历史记录中不存在名为 ${t} 的目标视图。`);let a=s-l;if(0==a)throw new m(`要回退到的目标视图 ${t} 即为当前视图。`);if(a>0)throw new m(`要回退到的目标视图 ${t} 在当前视图的后面，应该用前进。`);return a}}}),N("Navigator/Hash",function(e,t,n){const i=e("Hash");t.exports={init(e){let t=e.emitter;i.onchange(r,!0,function(n,r,i){if(e.hash=n,!e.enabled)return;if(!e.fireEvent)return void(e.fireEvent=!0);if(i&&t.fire("immediate",[n,e.hash$info]),!n)return r=e.router.toView(r),void t.fire("none",[r]);let o=e.hash$info[n],s=e.hash$info[r];if(o){let e=!0;if("cache"in o&&(e=o.cache,delete o.cache),t.fire("view",[o.view,o.args,{target:o,current:s,cache:e}]),s){let e=o.timestamp>s.timestamp?"forward":"back";t.fire(e,[s.view,o.view])}}else n=e.router.toView(n),r=e.router.toView(r),i?t.fire("start",[n,r]):t.fire("404",[n,r])})},set(e){i.set(r,e)}}}),N("Navigator/Infos",function(e,t,n){t.exports={set(e,t,n){let r=e.router.toHash(t),i=e.hash$info,o=e.storage,s=(new g).getTime(),l=i[r]={view:t,hash:r,timestamp:s,args:n||[]};return e.infos=function(e){let t=j.keys(e).map(function(t){return e[t]});return t=t.sort(function(e,t){return e.timestamp>t.timestamp?1:-1})}(i),o&&o.set("hash$info",i),l},get(e,t){let n=e.hash$info;if("string"==typeof t){return n[e.router.toHash(t)]}let r=t,i=e.infos;if("number"!=typeof r)return i;let o=n[e.hash];return i[i.findIndex(function(e){return e===o})+r]}}}),N("Navigator/Meta",function(e,t,n){const r={};t.exports={create:function(e,t){var n=e.id;if(!n)throw new m("创建 Navigator 实例时，必须指定 id 字段。");if(r[n])throw new m(`Navigator 已存在 id 为 ${n} 的实例。`);r[n]=!0;var i=t.storage,o=i&&i.get("hash$info")||{},s={id:n,hash:"",fireEvent:!0,rendered:!1,enabled:e.enabled,hash$info:o,infos:[],storage:null,emitter:null,router:null,this:null};return j.assign(s,t),s}}}),N("Navigator/Router",function(e,t,n){t.exports={create(){let e={view$hash:{},hash$view:{},view2hash:null,hash2view:null,toHash(t){let n=t;if(t in e.view$hash?n=e.view$hash[t]:"function"==typeof e.view2hash&&(n=e.view2hash(t)),"string"!=typeof(n=n||""))throw new m("自定义的 view -> hash 的转换关系中，hash 必须为 string 类型。");return n},toView(t){let n=t;if(t in e.hash$view?n=e.hash$view[t]:"function"==typeof e.hash2view&&(n=e.hash2view(t)),"string"!=typeof(n=n||""))throw new m("自定义的 hash -> view 的转换关系中，view 必须为 string 类型。");return n}};return e}}}),N("Navigator/Storage",function(e,t,n){t.exports={create(e){let t=e.Storage,n=e.id;return t?new t(n):null}}}),N("Navigator.defaults",function(e,t,n){const r=e("SessionStorage");t.exports={Storage:r,id:"",enabled:!0,repeated:!1,simulate:!1}}),N("Navigator",function(e,t,n){const r=e("String"),i=e("Emitter"),o=t.require("Back"),s=t.require("Meta"),l=t.require("Hash"),a=t.require("Infos"),u=t.require("Router"),f=t.require("Storage"),d=new b;function h(e,t){t="object"==typeof e?e:j.assign({id:e},t),t=j.assign({},n.defaults,t);let r=new i(this),o=u.create(),l=f.create(t),a=s.create(t,{emitter:r,router:o,storage:l,this:this});d.set(this,a),j.assign(this,{id:a.id}),t.simulate&&this.route(h.simulate)}h.prototype={constructor:h,id:"",render(){var e=d.get(this);this.enable(!0),e.rendered||l.init(e)},route(e){let t=d.get(this).router,n=e.view$hash,r=e.hash$view,i=e.toHash,o=e.toView;null===r?t.hash$view={}:j.assign(t.hash$view,r),null===n?t.view$hash={}:j.assign(t.view$hash,n),"function"==typeof i&&(t.view2hash=i),"function"==typeof o&&(t.hash2view=o)},to(e,...t){if("string"!=typeof e)throw new m("参数 name 必须为 string 类型。");let n=d.get(this),r=n.emitter,i=n.hash$info[n.hash],o=a.set(n,e,t);if(!n.enabled)return o;o.hash!=n.hash&&(n.fireEvent=!1,l.set(o.hash));let s=!1;return"cache"in o&&(s=o.cache,delete o.cache),i&&r.fire("to",[i.view,e,{cache:s,current:i,target:o}]),r.fire("view",[e,t,{cache:s,current:i,target:o}]),i&&r.fire("forward",[i.view,e]),o},back(e){switch(typeof e){case"boolean":e={fireEvent:e};break;case"number":case"string":e={target:e};break;default:e=e||{}}let t=d.get(this),n=o.getOffset(t,e.target),r=e.fireEvent,i=e.cache,s=this.get(n);return t.fireEvent=r===S||!!r,s&&"boolean"==typeof i&&(s.cache=i),c.go(n),s},get(e){let t=d.get(this);return a.get(t,e)},clear(){let e=d.get(this);e.storage&&e.storage.clear(),e.fireEvent=!1,e.hash$info={},l.set(""),e.fireEvent=!0},reserve(e){let t=d.get(this),n=t.router.toHash(e),r=t.hash$info[n];t.hash$info={[n]:r},t.storage&&t.storage.set("hash$info",t.hash$info)},enable(e){d.get(this).enabled=!!e},on(...e){d.get(this).emitter.on(...e)}},j.assign(h,{defaults:e("Navigator.defaults"),simulate:{toHash:e=>e?e=`/${e=(e=r.toHyphenate(e)).slice(1)}.html`:e,toView:e=>/^\/.+\.html$/.test(e)?(e=e.slice(1,-5),e=(e=r.toCamelCase(e))[0].toUpperCase()+e.slice(1)):e}}),t.exports=n=h}),N("Hash",function(e,t,n){const r=e("Object"),i=e("Query");t.exports=n={get(e,t,n){if("object"==typeof e){let t=null;if("href"in e)t=e;else{if(!("location"in e))throw new m("当参数 url 是一个 Object 类型时，只能是浏览器环境中的 location 或 window 对象。");t=e.location}e=t.href}let r=e.indexOf("#");if(r<0)return;let o=e.length,s=e.slice(r+1,o);if(s=unescape(s),""===t)return s;let l=i.parse(s);if(t===S)return l;if(!n||t in l)return l[t];t=t.toString().toLowerCase();for(let e in l)if(e.toLowerCase()==t)return l[e]},set(e,t,n){let o=null;if("object"==typeof e){if("href"in e)o=e;else{if(!("location"in e))throw new m("当参数 url 是一个 Object 类型时，只能是浏览器环境中的 location 或 window 对象。");o=e.location}e=o.href}let s=typeof t,l=/^(string|number|boolean)$/.test(s),a="";if(2==arguments.length&&l)a=C(t);else{let e="object"==s?t:r.make(t,n);a=i.stringify(e)}a=escape(a);let u=e.lastIndexOf("#");return u>-1&&(e=e.slice(0,u)),e=e+"#"+a,o&&(o.hash=a),e},has(e,t,i){if("object"==typeof e){let t=null;if("href"in e)t=e;else{if(!("location"in e))throw new m("当参数 url 是一个 Object 类型时，只能是浏览器环境中的 location 或 window 对象。");t=e.location}e=t.href}let o=n.get(e);if(!o)return!1;if(!t)return!r.isEmpty(o);if(t in o)return!0;if(i){t=t.toString().toLowerCase();for(let e in o)if(e.toLowerCase()==t)return!0}return!1},onchange(e,t,r){"function"==typeof t&&(r=t,t=!1);let i=n.get(e,"");t&&r.call(e,i,null,t),e.addEventListener("hashchange",function(){let t=i;i=n.get(e,""),r&&r(i,t,!1)})}}}),N("SessionStorage/Storage",function(e,t,n){const i=e("circular-json"),o=r.sessionStorage,s="@definejs/session-storage";let l=o.getItem(s)||"{}",a=i.parse(l)||{};function u(){l=i.stringify(a),o.setItem(s,l)}t.exports={set(e,t){a[e]=t,u()},get:e=>a[e],remove(e){delete a[e],u()},clear(){a={},u()}}}),N("SessionStorage.defaults",function(e,t,n){t.exports={name:""}}),N("SessionStorage",function(e,t,n){const r=e("Object"),i=t.require("Storage"),o=new b;class s{constructor(e,t){let i=(t=r.deepAssign({},n.defaults,t)).name;if(!i)throw new m("@definejs/session-storage 是针对多个应用的存储，每个应用都有自己独立的存储空间。\n                    请先指定所在应用的名称(通过配置 @definejs/session-storage.defaults 模块的 name 字段) 。");let s={name:i,id:e};o.set(this,s)}set(e,t){let n=o.get(this),r=i.get(n.name)||{},s=r[n.id]||{};"object"==typeof e?j.assign(s,e):s[e]=t,r[n.id]=s,i.set(n.name,r)}get(e){let t=o.get(this),n=(i.get(t.name)||{})[t.id];if(n)return 0==arguments.length?n:n[e]}remove(e){let t=o.get(this),n=i.get(t.name)||{},r=n[t.id];r&&(delete r[e],i.set(t.name,n))}clear(){let e=o.get(this),t=i.get(e.name);t&&(delete t[e.id],i.set(e.name,t))}}s.defaults=e("SessionStorage.defaults"),t.exports=n=s}),N("Package/All",function(e,t,n){const r=e("Url"),i=e("Tasker"),o=e("API"),s=e("Query");let l=null;function a(e,t){let n=function(e){let t=r.root()+e.url,n=e.query;return"string"==typeof n&&(n=s.parse(n)),n&&(t=s.add(t,n)),e.random&&(t=s.random(t,4)),t}(e),i=new o({url:n,field:{}});i.on({response(e,n,r){l=n||{},t&&t(l)}}),i.get()}t.exports={load(e,t){l?t&&t(l):i.todo("@definejs/package.load-all.sid",t,function(t){a(e,function(e){t(function(t){t&&t(e)})})})}}}),N("Package/Loader",function(e,t,n){const r=e("API"),o=e("Script"),s=e("Tasker");var l={css(e,t){let n=i.createElement("link");n.onerror=function(){throw new m(`css 文件加载失败: ${e}`)},n.onload=function(){t&&t({url:e,content:""})},n.rel="stylesheet",n.href=e,i.head.appendChild(n)},html(e,t){let n=new r({url:e,random:!1,field:null});n.on({success(n){let r=n.responseText;t&&t({url:e,content:r})},error(e){throw new m("error: "+e.status)}}),n.get()},js(e,t){o.load(e,function(){t&&t({url:e,content:""})})},json(e,t){let n=new r({url:e,field:{}});n.on({response(e,n,r){all=n||{},t&&t(all)}}),n.get()}};t.exports={load(e,t){let n=j.keys(e),r=new s(n);r.on({each(t,n,r){let i=e[t],o=l[t];if(!o)throw new m(`不支持加载 ${t} 类型的文件。`);o(i,function(e){r({type:t,url:e.url,content:e.content})})},all(e){let n={cache:!1};e.forEach(function(e){n[e.type]=e}),t&&t(n)}}),r.parallel()}}}),N("Package.defaults",function(e,t,n){t.exports={url:"packages/all.json",random:!0,query:null,loading:null,begin(e){e&&e.show()},end(e){e&&e.hide()}}}),N("Package",function(e,t,n){const r=e("Tasker"),i=t.require("All"),o=t.require("Loader"),s={};t.exports=n={defaults:e("Package.defaults"),load(e,t){let l=n.defaults;if("function"==typeof e)return t=e,void i.load(l,t);let a=s[e];if(a||null===a)return void(t&&t(a));let c={done:t},f=`@definejs/package:${e}`;r.todo(f,c,function(t){!function(e,t,n){let{begin:r,end:s,loading:l}=t;r&&r(l),i.load(t,function(r){let i=r[e];if(!i)return u.warn(`总包  ${t.url} 中不存在名为 ${e} 的配置节点。`),s&&s(l),void(n&&n(null));o.load(i,function(e){s&&s(l),n&&n(e)})})}(e,l,function(n){s[e]=n?j.assign({},n,{cache:!0}):null,t(function(e){e.done(n)})})})}}}),N("Tasker",function(e,t,n){const r=e("Emitter"),i=new b,o={};class s{constructor(e){let t={emitter:new r(this),list:e||[]};i.set(this,t)}parallel(e){let t=i.get(this);if(!(e=e||t.list).length)return void t.emitter.fire("all",[[]]);let n=e.length,r=n,o=new h(n),s=new h(n);e.forEach(function(e,i){!function(i){t.emitter.fire("each",[e,i,function(e){if(o[i]=e,s[i]=!0,!(--r>0)){for(let e=0;e<n;e++)if(!s[e])return;t.emitter.fire("all",[o])}}])}(i)})}serial(e){let t=i.get(this);if(!(e=e||t.list).length)return void t.emitter.fire("all",[]);let n=e.length,r=new h(n);!function i(o){let s=e[o];t.emitter.fire("each",[s,o,function(e){r[o]=e,++o<n?i(o):t.emitter.fire("all",[r])}])}(0)}on(...e){i.get(this).emitter.on(...e)}}j.assign(s,{todo(e,t,n){let r=o[e];r?r.push(t):(r=o[e]=[t],n(function(t){return o[e]=null,"function"==typeof t&&r.forEach(function(e,n){t(e,n)}),r}))}}),t.exports=s}),N("Confirm.defaults",function(e,t,n){const r=e("Dialog");t.exports={Dialog:r,mask:!0,height:140,autoClose:!0,volatile:!1,"z-index":99999,buttons:[{text:"确定",cmd:"ok",cssClass:"OK"},{text:"取消",cmd:"cancel",cssClass:"Cancel"}]}}),N("Confirm",function(e,t,n){let r=null,o=!1,s=[],l=null,a=13;function u(e){(r=r||function(){let e=n.defaults,t=new(0,e.Dialog)({cssClass:"definejs-confirm",volatile:e.volatile,mask:e.mask,autoClose:e.autoClose,height:e.height,"z-index":e["z-index"],buttons:e.buttons});return t.on("button",{ok(){let e=t.data("ok");e&&e()},cancel(){let e=t.data("cancel");e&&e()}}),t.on({show(){o=!0,a=13==a?"enter":"",(l=i.activeElement).blur(),t.$.find("footer button").get(0).focus()},hide(){o=!1;let e=s.shift();e&&u(e),l&&l.focus(),l=null,a=""}}),i.addEventListener("keydown",e=>{a=e.keyCode}),i.addEventListener("keyup",e=>{if(13!=e.keyCode||!o||"enter"==a)return;t.hide();let n=t.data("ok");n&&n()}),t}()).data(e),r.set({content:e.text}),r.show();let t=e.buttons||[];n.defaults.buttons.forEach(function(e,n){let i=r.$.find(`button[data-index="${n}"]`),o=t[n]||e.text;i.html(o)})}t.exports=n={defaults:e("Confirm.defaults"),show(e,t){let n="object"==typeof e?e:{text:e,ok:t};o?s.push(n):u(n)}}}),N("Defaults",function(e,t,n){const r=e("Object"),i={},o={},s="__hooked_for_defaults__";t.exports=n={set(e,t){if(h.isArray(e)){return void e.forEach(function(e){n.set(e,t)})}if(r.isPlain(e)){let t=e;return void r.each(t,function(e,t){n.set(e,t)})}let l=i[e];if(l)return void r.deepAssign(l,t);let a=o[e];if(a)return void r.deepAssign(a,t);o[e]=r.deepAssign({},t);let u=E.create();if(!u.require[s]){let e=u.require.bind(u);u.require=function(t){let n=e(t);if(t.endsWith(".defaults")){let e=t.slice(0,-".defaults".length),s=o[e],l=n;i[e]=r.deepAssign(l,s)}return n},u.require[s]=!0}},get(t){let n=i[t];return n||(n=i[t]=e(`${t}.defaults`)),n},config(...e){if(1==e.length&&"string"==typeof e[0])return n.get(...e);n.set(...e)}}}),N("Panel/Container",function(e,t,n){const r=e("String");t.exports={get:(e,t)=>r.format(t.container,{id:e}),set(e,t){if(!(t=t||e.$.selector)&&e.module&&(t=e.container),!t)throw new m("设置 container 时，请给参数 value 提供一个有效的值。");e.container=t,e.$.off(),e.$=e.this.$=$(e.container),e.panel&&(e.panel.$=e.$);let n=e.$.find.bind(e.$);e.$.find=function(...e){let t=n(...e);return t.each(function(e){let t=this;i.documentElement.contains(t)||t.parentNode.removeChild(t)}),t=n(...e)}}}}),N("Panel/Meta",function(e,t,n){const r=e("String");t.exports={create(e,t){const n={id:r.randomId("defnejs-panel-",4),container:"",rendered:!1,renderArgs:[],show:e.show,visible:!1,tplContainer:null,module:null,$:null,$emitter:null,emitter:null,tpl:null,panel:null,this:null};return j.assign(n,t),n}}}),N("Panel/Params",function(e,t,n){var r=e("String"),i=e("Object");t.exports={normalize(e,t,n){let o=typeof e;if("object"==o)return e;if("string"!=o)throw new m("无法识别参数 name 的类型。");if("object"==(o=typeof t)||"function"==o)return{[e]:t};if("string"!=o)throw new m("无法识别参数 sample 的类型。");if("function"==(o=typeof n))return{[e]:{[t]:n}};if("object"==o){let o={};return i.each(n,function(e,n){e=r.format(t,{value:e}),o[e]=n}),{[e]:o}}throw new m("无法识别参数 selector$fn 的类型。")}}}),N("Panel.defaults",function(e,t,n){t.exports={container:'[data-panel="{id}"]',show:!0}}),N("Panel",function(e,t,n){const r=e("jquery"),i=e("Object"),o=e("Emitter"),s=e("Template"),l=e("AppModule"),a=t.require("Container"),c=t.require("Meta"),f=t.require("Params"),d=new b,p={};function g(e,t){t=i.deepAssign({},n.defaults,t);const s=c.create(t,{moudle:null,container:e,tplContainer:e,$emitter:new o,emitter:new o(this),$:r(e),this:this});d.set(this,s),j.assign(this,{container:e,id:s.id,$:s.$})}j.assign(g.prototype,{container:"",id:"",$:null,module:null,render(...e){let t=d.get(this),n=t.emitter;t.renderArgs=e,t.rendered||(t.rendered=!0,n.fire("init")),n.fire("before-render",e),n.fire("render",e),t.show&&this.show(),n.fire("after-render",e)},show(...e){let t=d.get(this);return t.$.show(...e),t.visible=!0,t.emitter.fire("show")},hide(...e){let t=d.get(this);return t.$.hide(...e),t.visible=!1,t.emitter.fire("hide")},toggle(e){let t=d.get(this);return 0==arguments.length?t.visible?this.hide():this.show():e?this.show():this.hide(),t.visible},template(e){let t=d.get(this),n=t.tpl;return n||(n=t.tpl=new s(t.tplContainer)),e&&n.process(...arguments),n},fill(e,t){let n=d.get(this);return this.template(),n.tpl.render(e,t),n.emitter.fire("fill",[e])},refresh(){let e=d.get(this),t=e.renderArgs;return this.render(...t),e.emitter.fire("refresh",t)},reset(...e){return d.get(this).emitter.fire("reset",e)},close(...e){return d.get(this).emitter.fire("close",e)},visible(){return d.get(this).visible},rendered(){return d.get(this).rendered},fire(...e){return d.get(this).$emitter.fire(...e)},$on(e,t,n){let r=f.normalize(e,t,n);if(!r)return;let o=d.get(this);i.each(r,function(e,t){t&&("function"!=typeof t?i.each(t,function(t,n){o.$.on(e,t,n)}):o.$.on(e,t))})},$bind(e,t){let n=null;if("string"==typeof e)n={[e]:t};else{if("object"!=typeof e)throw new m("无法识别参数 selector 的类型。");n=e}if(!n)return;let r=d.get(this);i.each(n,function(e,t){t&&i.each(t,function(t,n){r.$.on(t,e,n)})})},wrap(e){let t=d.get(this),n=t.panel;if(n)return n;e=e||{},n=t.panel={};let r=new Set([...Reflect.ownKeys(t.this),...Reflect.ownKeys(g.prototype)]);r.delete("constructor"),r.delete("fire"),r.delete("wrap"),(r=[...r]).forEach(e=>{let r=t.this[e];"function"==typeof r&&(r=r.bind(t.this)),n[e]=r});let i=t.$emitter;return j.assign(n,e,{on:i.on.bind(i),off:i.off.bind(i)}),n},propagate(e,t){let n=d.get(this);t.forEach(function(t){e.on(t,function(...e){n.this.fire(t,e)})})},set(e,t){var n=d.get(this);if(i.isPlain(e))i.each(e,function(e,t){n.this.set(e,t)});else switch(e){case"show":case"rendered":n[e]=t;break;case"$":case"container":a.set(n,t);break;case"visible":n.visible=!!t;break;case"template":if(n.tpl)throw new m("当前实例中已创建了模板实例，无法再修改模板实例所关联的 DOM 容器。");n.tplContainer=n.$.find(t);break;default:throw new m(`目前不支持设置属性: ${e}`)}},destroy(){let e=d.get(this);e.emitter.destroy(),e.$emitter.destroy(),e.$.off(),d.delete(this)},on(...e){d.get(this).emitter.on(...e)}}),j.assign(g,{defaults:e("Panel.defaults"),define(e,t,r){r=r||{constructor:g,defaults:n.defaults},l.define(e,function(n,i,o){e=i.id;let s=a.get(e,r.defaults),l=new r.constructor(s);return d.get(l).module=l.module=i,o=t(n,i,l),o=l.wrap(o),p[e]=l,o})},update(e,t){e=h.isArray(e)?e:[e],t=t||{defaults:n.defaults},e.forEach(function(e){let n=p[e],r=a.get(e,t.defaults);n?n.set("container",r):u.warn(`不存在 ${r} 的 Panel 实例。`)})}}),t.exports=n=g}),N("View.defaults",function(e,t,n){t.exports={ViewSlider:null,container:'[data-view="{id}"]',background:""}}),N("View",function(e,t,n){const r=e("Panel");function i(e,t){t=j.assign({},n.defaults,t),r.call(this,e,t),this.$.addClass("definejs-view"),t.background&&this.$.css("background",t.background),t.fullscreen&&this.$.addClass("FullScreen")}i.prototype=j.assign(new r,{slider:function(e){let t=n.defaults.ViewSlider;t&&t.slide(this,e)}}),j.assign(i,{defaults:e("View.defaults"),define:function(e,t){r.define(e,t,{constructor:i,defaults:n.defaults})},update:function(e){r.update(e,{defaults:n.defaults})}}),t.exports=n=i}),N("jquery",function(t,n,r){return e.jQuery}),N("circular-json",function(e,t,n){var r="~",i="\\x"+("0"+r.charCodeAt(0).toString(16)).slice(-2),o="\\"+i,s=new k(i,"g"),l=new k(o,"g"),a=new k("(?:^|([^\\\\]))"+o),u=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},c=C;function f(e,t,n){return t instanceof h?function(e,t,n){for(var r=0,i=t.length;r<i;r++)t[r]=f(e,t[r],n);return t}(e,t,n):t instanceof c?t.length?n.hasOwnProperty(t)?n[t]:n[t]=function(e,t){for(var n=0,i=t.length;n<i;e=e[t[n++].replace(l,r)]);return e}(e,t.split(r)):e:t instanceof j?function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&(t[r]=f(e,t[r],n));return t}(e,t,n):t}var d={stringify:function(e,t,n,l){return d.parser.stringify(e,function(e,t,n){var l,a,c=!1,f=!!t,d=[],h=[e],p=[e],g=[n?r:"[Circular]"],m=e,y=1;return f&&(a="object"==typeof t?function(e,n){return""!==e&&t.indexOf(e)<0?void 0:n}:t),function(e,t){return f&&(t=a.call(this,e,t)),c?(m!==this&&(l=y-u.call(h,this)-1,y-=l,h.splice(y,h.length),d.splice(y-1,d.length),m=this),"object"==typeof t&&t?(u.call(h,t)<0&&h.push(m=t),y=h.length,(l=u.call(p,t))<0?(l=p.push(t)-1,n?(d.push((""+e).replace(s,i)),g[l]=r+d.join(r)):g[l]=g[0]):t=g[l]):"string"==typeof t&&n&&(t=t.replace(i,o).replace(r,i))):c=!0,t}}(e,t,!l),n)},parse:function(e,t){return d.parser.parse(e,function(e){return function(t,n){var s="string"==typeof n;return s&&n.charAt(0)===r?new c(n.slice(1)):(""===t&&(n=f(n,n,{})),s&&(n=n.replace(a,"$1"+r).replace(o,i)),e?e.call(this,t,n):n)}}(t))},parser:w};t.exports=d}),q.each(function(e){E.define(e,function(t,n,r){return q.require(e)})}),e.KISP=function({require:e,bind:t}){let n={require:e};return n.alert=t("Alert","show"),n.confirm=t("Confirm","show"),n.config=t("Defaults","config"),n.data=t("AppModule","data"),n.launch=t("App","launch"),n.load=t("Package","load"),n.panel=t("Panel","define"),n.proxy=t("Proxy","response"),n.route=t("App","route"),n.view=t("View","define"),n}(E)}(window,top,parent,window,document,location,navigator,localStorage,sessionStorage,console,history,setTimeout,setInterval,Array,Boolean,Date,Error,Function,JSON,Map,Math,Number,Object,RegExp,String,void 0);