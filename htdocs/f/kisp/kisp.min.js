!function(e,t,n,r,i,o,a,s,u,l,c,f,d,h,p,g,v,m,y,w,b,$,x,S,C,k,j){var I,T,P,N=function(e){var t=new w,n={seperator:"/",cross:!1,repeated:!1,Emitter:null};function r(e){var r=x.assign({},n,e),i=r.Emitter,o=i?new i(this):null,a={id$module:{},seperator:r.seperator,cross:r.cross,repeated:r.repeated,emitter:o,Emitter:i,this:this,require:function(e){return a.this.require(e)},fire:function(){o&&o.fire(...arguments)},getParent:function(e){var t=a.seperator,n=e.split(t);if(1==n.length)return null;var r=n.slice(0,-1).join(t);return a.id$module[r]||null}};t.set(this,a),this.on("require",function(e,t,n){t.fire("require",[n]);var r=t.parent;r&&r.fire("require",t.name,[n])})}return r.prototype={constructor:r,has:function(e){return t.get(this).id$module.hasOwnProperty(e)},define:function(e,n){if("string"!=typeof e)throw new v(`参数 id 的类型必须为 string，当前为: ${typeof e}`);var r=t.get(this),i=r.id$module;if(!r.repeated&&i[e])throw new v(`配置设定了不允许定义重复的模块: 已存在名为 ${e} 的模块`);var o=r.Emitter,a=o?new o:null,s=e.split(r.seperator).slice(-1)[0];i[e]={id:e,name:s,factory:n,emitter:a,parent:null,required:!1,count:0,exports:null,mod:null,fire:function(){a&&a.fire(...arguments)}}},require:function(n,r){if("string"!=typeof n)throw new v(`参数 id 的类型必须为 string，当前为: ${typeof n}`);var i=t.get(this),o=i.seperator;if(r===j&&(r=i.cross),!r&&n.includes(o))throw new v(`参数指定了或配置设定了不允许跨级加载模块: ${n}`);if(this.has(n)){var a=i.id$module[n];if(a.count++,a.required)return a.exports;a.required=!0;var s=a.factory,u=a.parent=i.getParent(n);if("function"!=typeof s)return a.exports=s,i.fire("require",[n,a,s]),s;var l={},c=a.mod=new e(n,{seperator:o,mm:this,emitter:a.emitter,exports:l,parent:u?u.mod:null});return(l=s(i.require,c,l))===j&&(l=c.exports),a.exports=l,c.exports=l,i.fire("require",[n,a,l]),l}},on:function(...e){var n=t.get(this).emitter;n&&n.on(...e)},destroy:function(){var e=t.get(this).emitter;e&&e.destroy(),t.delete(this)}},r}(function(){var e=new w;function t(t,n){var r=n.seperator,i=t.split(r),o=i.slice(-1)[0],a=n.parent;a&&(a=x.create(a,{require:{value:function(e){throw new v(`禁止通过父模块来加载同级模块：模块 ${t} 尝试加载同级模块 ${e}。`)}}}));var s={id:t,seperator:r,emitter:n.emitter,mm:n.mm,this:this};e.set(this,s),x.assign(this,{id:t,name:o,names:i,seperator:r,exports:n.exports,parent:a})}return t.prototype={constructor:t,id:"",name:"",seperator:"",exports:null,parent:null,on:function(...t){var n=e.get(this).emitter;n&&n.on(...t)},require:function(t){var n=e.get(this),r=n.seperator,i=n.id+r+t;if(t.includes(r))throw new v(`模块 ${n.id} 不允许跨级加载模块: ${i}`);return n.mm.require(i,!0)},bind:function(t,n){var r="object"==typeof t?t:{[t]:n},i=e.get(this);x.keys(r).forEach(function(e){var t=r[e],n="function"==typeof t?t:function(e){e.on(t)};i.this.on("require",e,n)})},render:function(e,...t){var n=this.require(e);if(!n)throw new v(`模块 ${meta.id} 不存在名为 ${e} 的直接子模块`);return n.render(...t),n}},t}()),M=function(e){var t=new e({cross:!0}),n={};return{has:t.has.bind(t),define:t.define.bind(t),require:t.require.bind(t),bind:function(e,n,r){return function(...i){var o=t.require(e),a=o[n];if("function"!=typeof a)throw new v(`要绑定的模块 ${e} 中不存在名为 ${n} 的方法或函数。`);return r=!0===r?o:r||null,a.call(r,...i)}},expose:function(e,t){if(h.isArray(e))e.forEach(function(e){n[e]=!0});else if("object"!=typeof e)2!=arguments.length?n[e]:n[e]=!!t;else{var r=e;x.keys(r).forEach(function(e){n[e]=!!r[e]})}}}}(N),q=M.define;q("Array",function(e,t,n){return n={each:function(e,t,n){for(var r=arguments.callee,i=e.length,o=0;o<i;o++){var a=e[o];if(n&&a instanceof h)r(a,t,!0);else if(!1===t(a,o))break}return e},map:function(e,t,n){for(var r,i=arguments.callee,o=e.length,a=[],s=0;s<o;s++){var u=e[s];if(n&&u instanceof h)r=i(u,t,!0);else{if(null===(r=t(u,s)))continue;if(r===j)break}a.push(r)}return a},keep:function(e,t,n){for(var r=arguments.callee,i=[],o=0,a=e.length;o<a;o++){var s=e[o],u=n&&s instanceof h?r(s,t,!0):t(s,o);i.push(u)}return i},grep:function(e,t,n){for(var r=arguments.callee,i=[],o=0,a=e.length;o<a;o++){var s=e[o];if(n&&s instanceof h)s=r(s,t,!0),i.push(s);else!0===t(s,o)&&i.push(s)}return i},slide:function(e,t,n){if(t>=e.length)return[e];n=n||1;for(var r=[],i=0,o=e.length;i<o;i+=n){var a=i+t;if(r.push(e.slice(i,a)),a>=o)break}return r},group:function(e,t,r){var i=n.slide(e,t,t);return!0===r&&(i[i.length-1]=e.slice(-t)),i},sum:function(e,t,r){var i=0;if("function"==typeof t){var o=t;return n.each(e,function(e,t){var n=o(e,t);if("number"!=typeof n)throw new v("第 "+t+" 个元素的返回值不是数字");i+=n}),i}for(var a=!(r===j),s=0,u=e.length;s<u;s++){var l=a?e[s][r]:e[s];if(isNaN(l)){if(!0===t)continue;throw new v("第 "+s+" 个元素的值为 NaN")}i+=$(l)}return i},pad:function(e,t,n,r){if(e==t)return[];"function"==typeof n?(r=n,n=1):n=b.abs(n||1);var i=[],o=0;if(e<t)for(var a=e;a<t;a+=n){var s=r?r(a,o):a;i.push(s),o++}else for(a=e;a>t;a-=n){s=r?r(a,o):a;i.push(s),o++}return i}}}),q("Date",function(e,t,n){var r=0;function i(e){new g;var t=e.indexOf(".")>0?".":e.indexOf("-")>0?"-":e.indexOf("/")>0?"/":e.indexOf("_")>0?"_":null;if(!t)return null;var n=e.split(t);return{yyyy:n[0],MM:n[1]||0,dd:n[2]||1}}function o(e){var t=e.indexOf(":")>0?":":null;if(!t)return null;var n=e.split(t);return{HH:n[0]||0,mm:n[1]||0,ss:n[2]||0}}return n={parse:function(e){var t=new g(e);if(!isNaN(t))return t;if("string"!=typeof e)return null;var n=e.split(" "),r=n[0];if(!r)return null;var a=(t=r.indexOf(":")>0?null:r)?n[1]||null:t;if(!t&&!a)return null;if(t&&a){var s=i(t),u=o(a);return new g(s.yyyy,s.MM-1,s.dd,u.HH,u.mm,u.ss)}if(t){s=i(t);return new g(s.yyyy,s.MM-1,s.dd)}if(a){var l=new g;u=o(a);return new g(l.getFullYear(),l.getMonth(),l.getDate(),u.HH,u.mm,u.ss)}},format:function(t,r){1==arguments.length?(r=t,t=new g):t=n.parse(t);for(var i=e("String"),o=t.getFullYear(),a=t.getMonth()+1,s=t.getDate(),u=t.getHours(),l=t.getMinutes(),c=t.getSeconds(),f=function(e,t){return i.padLeft(e,t,"0")},d=u<=12,h=[["yyyy",f(o,4)],["yy",C(o).slice(2)],["MM",f(a,2)],["M",a],["dddd","星期"+"日一二三四五六".charAt(t.getDay())],["dd",f(s,2)],["d",s],["HH",f(u,2)],["H",u],["hh",f(d?u:u-12,2)],["h",d?u:u-12],["mm",f(l,2)],["m",l],["ss",f(c,2)],["s",c],["tt",d?"AM":"PM"],["t",d?"A":"P"],["TT",d?"上午":"下午"],["T",d?"上":"下"]],p=r,v=i.replaceAll,m=0,y=h.length;m<y;m++){var w=h[m];p=v(p,w[0],w[1])}return p},add:function(e,t,r){var i=(e=n.parse(e)).getMilliseconds(),o=new g(e);return o.setMilliseconds(i+t),r&&(o=n.format(o,r)),o},addSeconds:function(e,t,r){return n.add(e,1e3*t,r)},addMinutes:function(e,t,r){return n.addSeconds(e,60*t,r)},addHours:function(e,t,r){return n.addMinutes(e,60*t,r)},addDays:function(e,t,r){return n.addHours(e,24*t,r)},addWeeks:function(e,t,r){return n.addDays(e,7*t,r)},addMonths:function(e,t,r){e=n.parse(e);var i=new g(e),o=e.getMonth();return i.setMonth(o+t),r&&(i=n.format(i,r)),i},addYears:function(e,t,r){return n.addMonths(e,12*t,r)},set:function(e){var t=n.parse(e);if(!t)throw new v("无法识别的日期时间格式: "+e);r=t-g.now()},get:function(e){var t=new g;return 0!=r&&(t=n.add(t,r)),e&&(t=n.format(t,e)),t},stringify:function(e){return e=e||new g,n.format(e,"yyyy-MM-dd HH:mm:ss")}}}),q("String",function(e,t,n){return n={random:function(e){if(e===j&&(e=12),"number"==typeof e){var t=e+1;t<0&&(t=0),(e=[]).length=t,e=e.join("x")}return e.replace(/x/g,function(e){return(16*b.random()|0).toString(16)}).toUpperCase()},format:function(e,t){var r=e,i=n.replaceAll;if("object"==typeof t)for(var o in t){var a=t[o];h.isArray(a)&&(a=a.join("")),r=i(r,"{"+o+"}",a)}else for(var s=[].slice.call(arguments,1),u=0,l=s.length;u<l;u++){a=s[u];h.isArray(a)&&(a=a.join("")),r=i(r,"{"+u+"}",a)}return r},replaceAll:function(e,t,n){return e.split(t).join(n)},replaceBetween:function(e,t,n,r){if("object"==typeof t){var i=t;t=i.begin,n=i.end,r=i.value}return e.indexOf(t)<0||e.indexOf(n)<0?e:e=e.split(t).map(function(e){var t=e.split(n);return 1==t.length?t[0]:r+t.slice(1).join(n)}).join("")},padLeft:function(e,t,n){var r=(e=C(e)).length;if(t<=r)return e.substr(-t);n=n||" ";var i=[];return i.length=t-r+1,i.join(n)+e},padRight:function(e,t,n){var r=(e=C(e)).length;if(r>=t)return e.substring(0,t);n=n||" ";var i=[];return i.length=t-r+1,e+i.join(n)},between:function(e,t,n){var r=e.indexOf(t);if(r<0)return"";r+=t.length;var i=e.indexOf(n,r);return i<0?"":e.substr(r,i-r)},toCamelCase:function(e){return e.replace(/^-ms-/,"ms-").replace(/-([a-z]|[0-9])/gi,function(e,t){return t.toString().toUpperCase()})},toHyphenate:function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.charAt(0).toLowerCase()})},toUtf8:function(t){var n=e("Array"),r=[];return n.each(t.split(""),function(e,t){var n=e.charCodeAt(0);n<128?r.push(n):n<2048?(r.push((1984&n)>>6|192),r.push(63&n|128)):(r.push((61440&n)>>12|224),r.push((4032&n)>>6|128),r.push(63&n|128))}),"%"+n.keep(r,function(e,t){return e.toString(16)}).join("%")},toValue:function(e){if("string"!=typeof e)return e;var t={true:!0,false:!1,null:null,undefined:j,NaN:NaN};return e in t?t[e]:e},split:function(t,n){for(var r=e("Array"),i=C(t).split(n[0]),o=1,a=n.length;o<a;o++)i=s(i,n[o],o);return i;function s(e,t,n){return n--,r.map(e,function(e,r){return 0==n?C(e).split(t):s(e,t,n)})}},getByteLength:function(e){return e?e.toString().replace(/[\u0100-\uffff]/g,"  ").length:0}}}),q("Emitter",function(e,t,n){var r=e("Object"),i=e("Tree"),o=new w;function a(e){var t={context:e,tree:new i};o.set(this,t)}return a.prototype={constructor:a,on:function(e,t){if(h.isArray(e))t?e.map(function(e){this.on(e,t)},this):this.on(...e);else{var n=o.get(this).tree,i=h.from(arguments);if((u=i.findIndex(function(e,t){return"object"==typeof e}))>=0){var a=i[u],s=i.slice(0,u);r.flat(a).forEach(function(e,t){var r=s.concat(e.keys),i=n.get(r)||{list:[],count:0};i.list.push(e.value),n.set(r,i)})}else{var u;if((u=i.findIndex(function(e,t){return"function"==typeof e}))<0)throw new v("参数中必须指定一个回调函数");t=i[u],s=(s=i.slice(0,u)).filter(function(e){return!!e});var l=n.get(s)||{list:[],count:0,enabled:!0,spreaded:!0};l.list.push(t),n.set(s,l)}}},off:function(e,t){var n=o.get(this).tree,i=h.from(arguments);if(0!=i.length)if((u=i.findIndex(function(e,t){return"object"==typeof e}))>=0){var a=i[u],s=i.slice(0,u);(l=r.flat(a)).forEach(function(e,t){var r=s.concat(e.keys),i=n.get(r);if(i){var o=i.list;if(o&&o.length){var a=e.value;i.list=o.filter(function(e){return e!==a})}}})}else{var u;(u=i.findIndex(function(e,t){return"function"==typeof e}))<0&&(u=i.length),t=i[u];s=i.slice(0,u);var l,c=n.get(s);if(c)(l=c.list)&&l.length&&(t?c.list=l.filter(function(e,n){return e!==t}):l.length=0)}else n.clear()},fire:function(e,t){var n=o.get(this),r=[...arguments],i=r.findIndex(function(e,t){return h.isArray(e)});i<0&&(i=r.length);var a=r.slice(0,i),s=n.tree.get(a);return s?(t=r[i]||[],s.count++,s.list.map(function(e,r){return e.apply(n.context,t)})):[]},set:function(e,t){var n=o.get(this);switch(e){case"context":n[e]=t;break;default:throw new v("不支持设置属性: "+e)}},destroy:function(){o.get(this).tree.destroy(),o.delete(this)}},a}),q("Object",function(e,t,n){return n={extend:x.assign,extendDeeply:function(e,t,r){var i=n.isPlain;function o(e,t){for(var n in e=e||{},t){var r=t[n],a=e[n];i(r)&&(r=o(a=i(a)?o({},a):{},r)),e[n]=r}return e}t&&"object"==typeof t&&(e=o(e,t)),r&&"object"==typeof r&&(e=o(e,r));var a=arguments.length;if(3>=a)return e;for(var s=3;s<a;s++){e=o(e,arguments[s])}return e},isEmpty:function(e){for(var t in e)return!1;return!0},isPlain:function(e){if(!e||"object"!=typeof e)return!1;var t,n=x.prototype.hasOwnProperty,r=e.constructor;try{if(r&&!n.call(e,"constructor")&&!n.call(r.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return t===j||n.call(e,t)},flat:function(e){var t=n.isPlain,r=[];if(!e||!t(e))return r;var i=[];return function e(n,o){for(var a in n){var s=n[a];(i=i.slice(0,o)).push(a),t(s)?e(s,o+1):r.push({keys:i,value:s})}}(e,0),r},each:function(e,t,r){for(var i in e){var o=e[i];if(!1===t(i,o))break;!0===r&&o&&"object"==typeof o&&n.each(o,t,!0)}},map:function(e,t,r){var i={};return n.each(e,function(e,o){r&&n.isPlain(o)?i[e]=n.map(o,t,r):i[e]=t(e,o)}),i},make:function(e,t,n){if(h.isArray(e)&&(n=t,t=e,e={}),!e||"object"!=typeof e)throw new v("参数 obj 必须为一个非空的对象，以作为容器对象。");var r=e,i=t.length-1;return t.map(function(e,t){var o=r[e];t<i?r=r[e]="object"==typeof o&&o||{}:r[e]=n}),e},filter:function(t,r){e("Array");var i={};if(h.isArray(r))r.forEach(function(e,n){e in t&&(i[e]=t[e])});else if(n.isPlain(r))n.each(r,function(e,n){e in t&&(i[e]=t[e])});else{if("string"!=typeof r)throw new v("无法识别参数 samples 的类型");var o=r;o in t&&(i[o]=t[o])}return i},remove:function(e,t){var n=x.assign({},e);if("string"==typeof t)delete n[t];else if(h.isArray(t))for(var r=0,i=t.length;r<i;r++)delete n[t[r]];else for(var o in t)delete n[o];return n}}}),q("Tree",function(e,t,n){var r=new w;function i(){r.set(this,{key$node:{},count:0})}function o(e,t){for(var n=t.length-1,r=0;r<=n;r++){var i=e[t[r]];if(!i||r==n)return i||null;e=i.key$node}}return i.prototype={constructor:i,set:function(e,t){if(!h.isArray(e)){var n=h.from(arguments);e=n.slice(0,-1),t=n.slice(-1)[0]}if(!(e=e.filter(function(e){return!!C(e)})).length)throw new v("过滤后的节点 key 为空数组。");var i=r.get(this),o=i.key$node,a=e.length-1,s=null;e.forEach(function(e,n){(s=o[e])||(i.count++,s=o[e]={key$node:{},parent:o,key:e}),n<a?o=s.key$node:s.value=t})},get:function(e){if(h.isArray(e)||(e=h.from(arguments)),!(e=e.filter(function(e){return!!C(e)})).length)throw new v("过滤后的节点 key 为空数组。");var t=o(r.get(this).key$node,e);return t?t.value:j},clear:function(){var e=r.get(this);e.key$node={},e.count=0},remove:function(t){if(h.isArray(t)||(t=[...arguments]),!(t=t.filter(function(e){return!!C(e)})).length)throw new v("过滤后的节点 key 为空数组。");var n=r.get(this),i=o(n.key$node,t);if(i){var a=e("Object"),s=i.key$node;!s||a.isEmpty(s)?(n.count--,delete i.parent[i.key]):delete i.value}},destroy:function(){r.delete(this)}},i}),q("Escape",function(e,t,n){return n={html:function(e){var t=C(e);return t=(t=(t=(t=(t=t.replace(/[&'"<>\/\\\-\x00-\x09\x0b-\x0c\x1f\x80-\xff]/g,function(e){return"&#"+e.charCodeAt(0)+";"})).replace(/ /g,"&nbsp;")).replace(/\r\n/g,"<br />")).replace(/\n/g,"<br />")).replace(/\r/g,"<br />")},attribute:function(e){return C(e).replace(/[&'"<>\/\\\-\x00-\x1f\x80-\xff]/g,function(e){return"&#"+e.charCodeAt(0)+";"})},script:function(e){var t=C(e);return t=(t=(t=(t=(t=t.replace(/[\\"']/g,function(e){return"\\"+e})).replace(/%/g,"\\x25")).replace(/\n/g,"\\n")).replace(/\r/g,"\\r")).replace(/\x01/g,"\\x01")},query:function(e){var t=C(e);return escape(t).replace(/\+/g,"%2B")},hrefScript:function(e){var t=n.escapeScript(e);return t=t.replace(/%/g,"%25"),t=n.escapeElementAttribute(t)},regexp:function(e){return C(e).replace(/[\\\^\$\*\+\?\{\}\.\(\)\[\]]/g,function(e,t){return"\\"+e})}}}),q("Fn",function(e,t,n){return{noop:function(...e){return e[0]},delay:function(t,n,r){if(n){if(!1!==t&&null!=t){var i=e("Math"),o="number"==typeof t?t:i.randomInt(t.min,t.max);return f(function(){n.apply(null,r)},o)}n.apply(null,r)}}}}),q("Math",function(e,t,n){return n={randomInt:function(e,t){var n=arguments.length;if(0==n)return $(C(b.random()).replace(".","").replace(/^0*/g,""));1==n&&(t=e,e=0);var r=t-e+1;return b.floor(b.random()*r+e)},slide:function(e,t,n){return(e+=n=n||1)>=0?e%t:(t-b.abs(e)%t)%t},next:function(e,t){return n.slide(e,t,1)},previous:function(e,t,r){return n.slide(e,t,-1)},parsePercent:function(e){if("string"!=typeof e)return e;var t=e.trim();return"%"!=t.slide(-1)?e:parseFloat(t)/100}}}),q("Hash",function(e,t,n){var r=e("Object");return n={get:function(t,n,r){"object"==typeof t&&(t="href"in t?t.href:t.location.href);var i=t.indexOf("#");if(!(i<0)){var o=t.length,a=t.slice(i+1,o);if(a=unescape(a),""===n)return a;var s=e("Query").parse(a);if(n===j)return s;if(!r||n in s)return s[n];for(var u in n=n.toString().toLowerCase(),s)if(u.toLowerCase()==n)return s[u]}},set:function(t,n,i){var o=null;"object"==typeof t&&(t=(o="href"in t?t:t.location).href);var a=typeof n,s=/^(string|number|boolean)$/.test(a),u="";if(2==arguments.length&&s)u=C(n);else{var l=e("Query"),c="object"==a?n:r.make(n,i);u=l.stringify(c)}u=escape(u);var f=t.lastIndexOf("#");return f>-1&&(t=t.slice(0,f)),t=t+"#"+u,o&&(o.hash=u),t},has:function(e,t,i){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var o=n.get(e);if(!o)return!1;if(!t)return!r.isEmpty(o);if(t in o)return!0;if(i)for(var a in t=t.toString().toLowerCase(),o)if(a.toLowerCase()==t)return!0;return!1},onchange:function(e,t,r){"function"==typeof t&&(r=t,t=!1);var i=n.get(e,"");t&&r.call(e,i,null,t),k(e).on("hashchange",function(){var t=i;i=n.get(e,""),r&&r(i,t,!1)})}}}),q("Query",function(e,t,n){var r=e("Object");function i(e,t){"object"==typeof(t=t||"")&&(t=n.stringify(t)),t&&(t="?"+t);var r=e.includes("?"),i=e.includes("#"),o=[];return r&&i?(o=e.split(/\?|#/g))[0]+t+"#"+o[2]:r?(o=e.split("?"))[0]+t:i?(o=e.split("#"))[0]+t+"#"+o[1]:e+t}return n={parse:function(t,r,i){if(!t||"string"!=typeof t)return{};var o=e("String"),a=i?unescape:decodeURIComponent,s=!r,u=o.toValue,l={};return t.split("&").map(function(e){var t=e.split("="),r=a(t[0]),i=t[1];if(t.length>1&&(i=a(i),i=s&&i.indexOf("=")>0?n.parse(i):u(i)),r in l){var o=l[r];o instanceof h?o.push(i):l[r]=[o,i]}else l[r]=i}),l},stringify:function(e,t){if(null==e)return C(e);switch(typeof e){case"string":case"number":case"boolean":return e}if(e instanceof C||e instanceof $||e instanceof p||e instanceof g)return e.valueOf();if(h.isArray(e))return"["+e.join(", ")+"]";var i=t?escape:encodeURIComponent,o=[];return r.each(e,function(e,t){e=i(e),t!==j?(t=n.stringify(t),t=i(t),o.push(e+"="+t)):o.push(e)}),o.join("&")},get:function(e,t,r){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var i=e.indexOf("?");if(!(i<0)){var o=e.indexOf("#");o<0&&(o=e.length);var a=e.slice(i+1,o);if(""===t)return decodeURIComponent(a);var s=n.parse(a);if(t===j)return s;if(!r||t in s)return s[t];for(var u in t=t.toString().toLowerCase(),s)if(u.toLowerCase()==t)return s[u]}},add:function(e,t,r){var i=n.get(e)||{};"object"==typeof t?x.assign(i,t):i[t]=r;var o={};for(var t in i){null!==(r=i[t])&&(o[t]=r)}return n.set(e,o)},remove:function(e,t){var r=null;"object"==typeof e&&(e=(r="href"in e?e:e.location).href);var o="";return t&&delete(o=n.get(e))[t],e=i(e,o),r&&(r.href=e),e},random:function(t,r){var i=e("String").random(r);return n.add(t,i,j)},set:function(e,t,n){var o=null;"object"==typeof e&&(e=(o="href"in e?e:e.location).href);var a=typeof t,s=/^(string|number|boolean)$/.test(a);return e=i(e,2==arguments.length&&s?encodeURIComponent(t):"object"==a?t:r.make(t,n)),o&&(o.href=e),e},has:function(e,t,i){"object"==typeof e&&(e="href"in e?e.href:e.location.href);var o=n.get(e);if(!o)return!1;if(!t)return!r.isEmpty(o);if(t in o)return!0;if(i)for(var a in t=t.toString().toLowerCase(),o)if(a.toLowerCase()==t)return!0;return!1},escape:function(e){var t=C(e);return escape(t).replace(/\+/g,"%2B")}}}),q("JSON",function(e,t,n){var i=r.JSON;return{parse:function(e){try{return i.parse(e)}catch(t){l.warn("使用原生的 JSON.parse() 方法无法解析:",e)}try{var t=["return (function () { ","   var obj = "+e+";","   return obj;","})();"].join("\r\n");return new m(t)()}catch(t){l.warn("使用 new Function() 方法无法解析:",e)}return null},stringify:function(){return i.stringify(...arguments)}}}),q("Script",function(e,t,n){e("String");var i=e("Object"),o={url:"",id:"",charset:"utf-8",document:r.document,onload:null};function a(e,t,n,r){var i;if("object"==typeof e){var o=e;i=o.id,e=o.url,t=o.charset,n=o.document,r=o.onload}var a=n.createElement("script");r&&(a.readyState?a.onreadystatechange=function(){var e=a.readyState;"loaded"!=e&&"complete"!=e||(a.onreadystatechange=null,r())}:a.onload=r),a.src=e,t&&(a.charset=t),i&&(a.id=i),n.head.appendChild(a)}return{load:function(e){var t=x.assign({},o);if(i.isPlain(e))x.assign(t,e);else{switch(t.url=e,typeof arguments[1]){case"string":t.charset=arguments[1];break;case"object":t.document=arguments[1];break;case"function":t.onload=arguments[1]}switch(typeof arguments[2]){case"object":t.document=arguments[2];break;case"function":t.onload=arguments[2]}arguments[3]&&(t.onload=arguments[3])}var n=t.url;if("string"==typeof n)a(t);else{if(!(n instanceof h))throw new v("参数 params.url 必须为 string 或 string 的数组");!function(e,t,n,r){if(0!=e.length){var i=0;!function(){var o=arguments.callee;a(e[i],t,n,function(){++i<e.length?o():r&&r()})}()}else r&&r()}(n,t.charset,t.document,t.onload)}}}}),q("StyleSheet",function(e,t,n){var i={url:"",id:"",charset:"utf-8",document:r.document,onload:null};function o(e,t,n,r){var i;if("object"==typeof e){var o=e;i=o.id,e=o.url,t=o.charset,n=o.document,r=o.onload}var a=n.createElement("link");r&&(a.readyState?a.onreadystatechange=function(){var e=a.readyState;"loaded"!=e&&"complete"!=e||(a.onreadystatechange=null,r())}:a.onload=r),a.href=e,a.rel="stylesheet",t&&(a.charset=t),i&&(a.id=i),n.head.appendChild(a)}return{load:function(t){var n=e("Object"),r=x.assign({},i);if(n.isPlain(t))x.assign(r,t);else{switch(r.url=t,typeof arguments[1]){case"string":r.charset=arguments[1];break;case"object":r.document=arguments[1];break;case"function":r.onload=arguments[1]}switch(typeof arguments[2]){case"object":r.document=arguments[2];break;case"function":r.onload=arguments[2]}arguments[3]&&(r.onload=arguments[3])}var a=r.url;if("string"==typeof a)o(r);else{if(!(a instanceof h))throw new v("参数 params.url 必须为 string 或 string 的数组");!function(e,t,n,r){if(0!=e.length){var i=0;!function(){var a=arguments.callee;o(e[i],t,n,function(){++i<e.length?a():r&&r()})}()}else r&&r()}(a,r.charset,r.document,r.onload)}}}}),q("Tasks",function(e,t,n){var r=e("Emitter"),i=new w,o={};function a(e){var t={emitter:new r(this),list:e||[]};i.set(this,t)}return a.prototype={constructor:a,parallel:function(e){var t=i.get(this);if((e=e||t.list).length){var n=e.length,r=n,o=new h(n),a=new h(n);e.forEach(function(e,i){!function(i){t.emitter.fire("each",[e,i,function(e){if(o[i]=e,a[i]=!0,!(--r>0)){for(var s=0;s<n;s++)if(!a[s])return;t.emitter.fire("all",[o])}}])}(i)})}else t.emitter.fire("all",[[]])},serial:function(e){var t=i.get(this);if((e=e||t.list).length){var n=e.length,r=new h(n);!function i(o){var a=e[o];t.emitter.fire("each",[a,o,function(e){r[o]=e,++o<n?i(o):t.emitter.fire("all",[r])}])}(0)}else t.emitter.fire("all",[])},on:function(...e){i.get(this).emitter.on(...e)}},x.assign(a,{parallel:function(e,t){if(t){var n=new a(e);n.on(t),n.parallel()}},serial:function(e,t){if(t){var n=new a(e);n.on(t),n.serial()}},todo:function(e,t,n){var r=o[e];r?r.push(t):(r=o[e]=[t],n(function(t){return o[e]=null,"function"==typeof t&&r.forEach(function(e,n){t(e,n)}),r}))}}),a}),q("KISP",function(e,t,n){return{name:"pc",version:"8.2.0",edition:"min",md5:"6A8E8749DFD52D3C529F82773DC51823",babel:"",modules:["Array","Date","String","Emitter","Object","Tree","Escape","Fn","Math","Hash","Query","JSON","Script","StyleSheet","Tasks","KISP","Defaults","Config","Data","Router","Proxy","Proxy.defaults","Url","Url.defaults","App","App.defaults","App.config","OuterModule","OuterModule.defaults","$","Navigator","Navigator.defaults","SessionStorage","SessionStorage.defaults","Storage","CircularJSON","LocalStorage","LocalStorage.defaults","Package","Package.defaults","Loading","Loading.defaults","Style","RandomId","Mask","Mask.defaults","Mask.config","Session","Session.defaults","View","View.defaults","View.config","Panel","Panel.defaults","Template","HTMLParser","Mapper","Alert","Alert.defaults","Alert.config","Dialog","Dialog.defaults","Dialog.config","Confirm","Confirm.defaults","API","API.defaults","Tabs","Tabs.defaults","Tabs.config","Toast","Toast.defaults"],require:function(t){return e(t)},create:function(t,...n){return new(e(t))(...n)},config:M.bind("Defaults","config"),data:M.bind("Data","data"),route:M.bind("Router","set"),proxy:M.bind("Proxy","response"),launch:M.bind("App","launch"),view:M.bind("View","define"),panel:M.bind("Panel","define"),load:M.bind("Package","load"),alert:M.bind("Alert","show"),confirm:M.bind("Confirm","show")}}),q("Defaults",function(e,t,n){var r=e("Object"),i=new(e("Config")),o={};function a(t){if(!o[t]){var n=e(`${t}.defaults`),a=e(`${t}.config`),s=r.extendDeeply({},n,a);o[t]=!0,i.set(t,s)}}return n={set:function(e,t){var n="object"==typeof e?e:{[e]:t};r.each(n,function(e,t){a(e),i.set(e,t)})},get:function(e){return a(e),i.get(e)},clone:function(e,...t){return a(e),i.clone(...arguments)},config:function(e,t){if(1==arguments.length&&"string"==typeof e)return n.get(e);n.set(...arguments)}}}),q("Config",function(e,t,n){var r=e("Object"),i=new w;function o(){i.set(this,{name$data:{}})}return o.prototype={constructor:o,set:function(e,t){var n=i.get(this).name$data,o="object"==typeof e?e:{[e]:t};r.each(o,function(e,t){if(e in n){var i=n[e];r.isPlain(i)?r.extendDeeply(i,t):n[e]=t}else n[e]=t})},get:function(e){return i.get(this).name$data[e]},clone:function(e,...t){var n=this.get(e);return r.extendDeeply({},n,...t)}},o}),q("Data",function(e,t,n){e("Object");var r=new(e("Config"));return{data:function(e,t){if(1==arguments.length&&"string"==typeof e)return r.get(e);r.set(...arguments)}}}),q("Router",function(e,t,n){var r=e("Object"),i={};return{set:function(e,t){if(i[e])throw new v(`重复定义的路由器: ${e}`);i[e]=t},bind:function(e,t,n){var o=r.map(i,function(r,i){return"function"==typeof i&&(i=i(e,t,n)),i});return t.bind(o),o}}}),q("Proxy",function(e,t,n){var r=e("Defaults"),i=e("Fn"),o=null;function a(e){var n=r.get(t.id).delay,o=[].slice.call(arguments,1);i.delay(n,e,o)}function s(e,t){if(e){var n=t.successCode,r=t.field,i=e[r.code];if(i==n){var o=e[r.data]||{};a(t.success,o,e)}else{var s=e[r.msg]||"";a(t.fail,i,s,e)}}else a(t.error)}return{request:function(n,r){var i=e("Url");if(i.isExt(n,".js"))!function(n,r){var i=t.require("Url").get(n);e("Script").load(i,function(){var e=o;o=null,"function"==typeof e&&(e=e(r.data,r)),s(e,r)})}(n,r);else{if(!i.isExt(n,".json"))throw new v("不支持参数 file 的文件类型: "+n);!function(n,r){var i=t.require("Url").get(n),o=new XMLHttpRequest;o.open("get",i,!0),o.onreadystatechange=function(){4==o.readyState&&(200==o.status?s(e("JSON").parse(o.responseText),r):a(r.error))},o.send(null)}(n,r)}},response:function(e){o=e}}}),q("Proxy.defaults",{base:"",delay:{min:500,max:3e3}}),q("Url",function(e,t,n){e("String");var r={root:"",url:"",dir:""};return n={root:function(){if(r.root)return r.root;var n=e("Defaults").get(t.id).root;return"function"==typeof n&&(n=n()),n.endsWith("/")||(n+="/"),r.root=n,n},dir:function(){if(r.dir)return r.dir;var e=n.get().split("/").slice(0,-1).join("/")+"/";return r.dir=e,e},get:function(){if(r.url)return r.url;var n=e("Defaults").get(t.id).id;if(!n)throw new v("必须给引用了 KISP 框架文件的 <script> 标签分配一个 id。");var o=i.getElementById(n).src.split("?")[0];return r.url=o,o},main:function(e){return e=(e=e.split("#")[0]).split("?")[0]},isFull:function(e){return"string"==typeof e&&(e.startsWith("http://")||e.startsWith("https://"))},isExt:function(e,t){return"string"==typeof e&&"string"==typeof t&&(e=n.main(e)).slice(0-t.length).toLowerCase()==t.toLowerCase()},resolve:function(e){var t=arguments.length;if(0==t)throw new v("resolveUrl requires at least one argument; got none.");var n=i.createElement("base");if(n.href=e,1==t)return n.href;var r=i.head;r.insertBefore(n,r.firstChild);for(var o="",a=i.createElement("a"),s=1;s<t;s++)a.href=arguments[s],o=a.href,n.href=o;return r.removeChild(n),o}}}),q("Url.defaults",{id:"script-KISP",root:`${o.protocol}//${o.host}${o.pathname.split("/").slice(0,-1).join("/")}/`}),q("Proxy/Url",function(e,t,n){var r=e("Defaults"),i=e("Query"),o=e("Url");return{get:function(e){return e=function(e){if(o.isFull(e))return e;var n=r.get(t.parent.id).base;if(o.isFull(n))return n+e;var i=o.root();return"/"!=e.slice(0,1)&&(i+=n),i+e}(e),i.random(e)}}}),q("App",function(e,t,n){e("String");var r=e("Defaults"),i=e("OuterModule"),o=e("Router"),a=t.require("Navigator"),s=r.get(t.id);return n={init:function(t){var n=s.name,u=s.root,l=i.defaults.seperator,c=s.predefines||[];if(!n)throw new v("必须首先给应用分配一个唯一的名称，用于在存储中与其它应用区分开。");if("string"!=typeof u)throw new v("应用的顶级模块名称必须为一个 string。");if(u.includes(l))throw new v("应用的顶级模块名称不能含有父子模块的分隔符: "+l);["SessionStorage","LocalStorage"].forEach(function(e){M.has(e)&&r.set(e,{name:n})}),c.forEach(function(t){i.define(t,function(){return e(t)})}),i.define(u,function(e,n,r){s.navigator&&(r=a.create({container:s.view.container,preload:s.view.preload,slide:s.view.slide,animate:s.view.animate,name:s.navigator,module:n})),s.prebind&&o.bind(e,n,r),t&&t(e,n,r)})},launch:function(e){n.init(e),i.require(s.root)}}}),q("App.defaults",{root:"",name:"",navigator:"default-navigator",prebind:!0,view:{},predefines:["KISP","$"]}),q("App.config",{}),q("OuterModule",function(e,t,n){var r=e("Defaults"),i=e("Emitter"),o=r.clone(t.id,{Emitter:i}),a=new N(o);return{defaults:o,define:a.define.bind(a),require:a.require.bind(a)}}),q("OuterModule.defaults",{seperator:"/",repeated:!1,cross:!1}),q("$",function(e,t,n){return r.jQuery||null}),q("App/Navigator",function(e,t,n){e("Tasks");var r=e("Navigator"),i=t.require("Views");return{create:function(e){var t=e.module,n=new r(e.name);e.animate,e.slide;return n.on("view",function(t,n,r){i.load(t,e,function(e){r.cache&&e.rendered()?e.show():e.render(...n)})}),e.preload&&n.on("immediate",function(t,n){var r=x.keys(n).map(function(e){return n[e]});r=r.sort(function(e,t){return e.timestamp>t.timestamp?-1:1}),i.load(r,e,function(){})}),n.on("forward",function(n,r){n=t.require(n),i.load(r,e,function(e){n.hide(),e.show()})}),n.on("back",function(n,r){n=t.require(n),i.load(r,e,function(e){n.hide(),e.show()})}),n}}}),q("Navigator",function(e,t,n){var r=e("String"),i=e("Defaults"),o=e("Emitter"),a=t.require("Back"),s=t.require("Meta"),u=t.require("Hash"),l=t.require("Infos"),f=t.require("Router"),d=t.require("Storage"),h=new w;function p(e,n){n="object"==typeof e?e:x.assign({id:e},n),n=i.clone(t.id,n);var r=new o(this),a=f.create(),u=d.create(n),l=s.create(n,{emitter:r,router:a,storage:u,this:this});h.set(this,l),x.assign(this,{id:l.id,_meta:l}),n.simulate&&this.route(p.simulate)}return p.prototype={constructor:p,id:"",render:function(){var e=h.get(this);this.enable(!0),e.rendered||u.init(e)},route:function(e){var t=h.get(this).router,n=e.view$hash,r=e.hash$view,i=e.toHash,o=e.toView;null===r?t.hash$view={}:x.assign(t.hash$view,r),null===n?t.view$hash={}:x.assign(t.view$hash,n),"function"==typeof i&&(t.view2hash=i),"function"==typeof o&&(t.hash2view=o)},to:function(e,...t){if("string"!=typeof e)throw new v("参数 name 必须为 string 类型。");var n=h.get(this),r=n.emitter,i=n.hash$info[n.hash],o=l.set(n,e,t);if(!n.enabled)return o;o.hash!=n.hash&&(n.fireEvent=!1,u.set(o.hash));var a=!1;return"cache"in o&&(a=o.cache,delete o.cache),i&&r.fire("to",[i.view,e,{cache:a,current:i,target:o}]),r.fire("view",[e,t,{cache:a,current:i,target:o}]),i&&r.fire("forward",[i.view,e]),o},back:function(e){switch(typeof e){case"boolean":e={fireEvent:e};break;case"number":case"string":e={target:e};break;default:e=e||{}}var t=h.get(this),n=a.getOffset(t,e.target),r=e.fireEvent,i=e.cache,o=this.get(n);return t.fireEvent=r===j||!!r,o&&"boolean"==typeof i&&(o.cache=i),c.go(n),o},get:function(e){var t=h.get(this);return l.get(t,e)},clear:function(){var e=h.get(this);e.storage&&e.storage.clear(),e.fireEvent=!1,e.hash$info={},u.set(""),e.fireEvent=!0},reserve:function(e){var t=h.get(this),n=t.router.toHash(e),r=t.hash$info[n];t.hash$info={[n]:r},t.storage&&t.storage.set("hash$info",t.hash$info)},enable:function(e){h.get(this).enabled=!!e},on:function(...e){h.get(this).emitter.on(...e)}},x.assign(p,{simulate:{toHash:function(e){return e?e=`/${e=(e=r.toHyphenate(e)).slice(1)}.html`:e},toView:function(e){return/^\/.+\.html$/.test(e)?(e=e.slice(1,-5),e=(e=r.toCamelCase(e))[0].toUpperCase()+e.slice(1)):e}}}),p}),q("Navigator.defaults",{id:"",enabled:!0,storage:"session",repeated:!1,simulate:!1}),q("Navigator/Back",function(e,t,n){e("$"),e("String");return{getOffset:function(e,t){if(!t)return-1;var n=typeof t;if("number"==n){if(t<0)throw new v("要回退的步数(参数 target) 如果指定为数字时，只能是正数。");return 0-(t||1)}if("string"!=n)throw new v("要回退的目标视图(参数 target) 只能是 number 或 string 类型。");var r=e.hash$info[e.hash];if(!r)throw new v("当前视图为空，无法回退。");var i=e.this.get(),o=r.view,a=-1,s=-1;if(i.forEach(function(e,n){var r=e.view;r==t&&(a=n),r==o&&(s=n)}),a<0)throw new v(`历史记录中不存在名为 ${t} 的目标视图。`);var u=a-s;if(0==u)throw new v(`要回退到的目标视图 ${t} 即为当前视图。`);if(u>0)throw new v(`要回退到的目标视图 ${t} 在当前视图的后面，应该用前进。`);return u}}}),q("Navigator/Meta",function(e,t,n){e("$"),e("String"),e("Date");var r={};return{create:function(e,n){var i=e.id;if(!i)throw new v(`创建 ${t.parent.id} 实例时，必须指定 id 字段。`);if(r[i])throw new v(`${t.parent.id} 已存在 id 为 ${i} 的实例。`);r[i]=!0;var o=n.storage,a=o&&o.get("hash$info")||{},s={id:i,hash:"",fireEvent:!0,rendered:!1,enabled:e.enabled,hash$info:a,infos:[],storage:null,emitter:null,router:null,this:null};return x.assign(s,n),s}}}),q("Navigator/Hash",function(e,t,n){e("$"),e("String"),e("Date");var i=e("Hash");return{init:function(e){var t=e.emitter;i.onchange(r,!0,function(n,r,i){if(e.hash=n,e.enabled)if(e.fireEvent){if(i&&t.fire("immediate",[n,e.hash$info]),!n)return r=e.router.toView(r),void t.fire("none",[r]);var o=e.hash$info[n],a=e.hash$info[r];if(o){var s=!0;if("cache"in o&&(s=o.cache,delete o.cache),t.fire("view",[o.view,o.args,{target:o,current:a,cache:s}]),a){var u=o.timestamp>a.timestamp?"forward":"back";t.fire(u,[a.view,o.view])}}else n=e.router.toView(n),r=e.router.toView(r),i?t.fire("start",[n,r]):t.fire("404",[n,r])}else e.fireEvent=!0})},set:function(e){i.set(r,e)}}}),q("Navigator/Infos",function(e,t,n){e("$"),e("String");var r=e("Date");return{set:function(e,t,n){var i=e.router.toHash(t),o=e.hash$info,a=e.storage,s=new g,u=r.stringify(s),l=s.getTime(),c=o[i]={view:t,hash:i,datetime:u,timestamp:l,args:n||[]};return e.infos=function(e){var t=x.keys(e).map(function(t){return e[t]});return t=t.sort(function(e,t){return e.timestamp>t.timestamp?1:-1})}(o),a&&a.set("hash$info",o),c},get:function(e,t){var n=e.hash$info;if("string"==typeof t)return n[e.router.toHash(t)];var r=t,i=e.infos;if("number"!=typeof r)return i;var o=n[e.hash];return i[i.findIndex(function(e){return e===o})+r]}}}),q("Navigator/Router",function(e,t,n){e("$"),e("String");return{create:function(){var e={view$hash:{},hash$view:{},view2hash:null,hash2view:null,toHash:function(t){var n=t;if(t in e.view$hash?n=e.view$hash[t]:"function"==typeof e.view2hash&&(n=e.view2hash(t)),"string"!=typeof(n=n||""))throw new v("自定义的 view -> hash 的转换关系中，hash 必须为 string 类型。");return n},toView:function(t){var n=t;if(t in e.hash$view?n=e.hash$view[t]:"function"==typeof e.hash2view&&(n=e.hash2view(t)),"string"!=typeof(n=n||""))throw new v("自定义的 hash -> view 的转换关系中，view 必须为 string 类型。");return n}};return e}}}),q("Navigator/Storage",function(e,t,n){e("$"),e("String");return{create:function(n){var r=n.storage,i=n.id;if(!r)return null;var o="session"==(r=r.toLowerCase())?e("SessionStorage"):"local"==r?e("LocalStorage"):null;if(!o)throw new v(`${t.id} 不支持 Storage 类型: ${r}，请指定为 'session' 或 'local'。 `);return r=new o(i)}}}),q("SessionStorage",function(e,t,n){var r=e("Storage"),i=e("Defaults"),o=r("session"),a=new w;function s(e,n){var r=(n=i.clone(t.id,n)).name;if(!r)throw new v(`KISP.${t.id} 是针对多个应用的存储，每个应用都有自己独立的存储空间。\n                请先指定所在应用的名称(通过配置 ${t.id} 模块的 name 字段) 。`);var o={name:r,id:e};a.set(this,o)}return s.prototype={constructor:s,set:function(e,t){var n=a.get(this),r=o.get(n.name)||{},i=r[n.id]||{};"object"==typeof e?x.assign(i,e):i[e]=t,r[n.id]=i,o.set(n.name,r)},get:function(e){var t=a.get(this),n=(o.get(t.name)||{})[t.id];if(n)return 0==arguments.length?n:n[e]},remove:function(e){var t=a.get(this),n=o.get(t.name)||{},r=n[t.id];r&&(delete r[e],o.set(t.name,n))},clear:function(){var e=a.get(this),t=o.get(e.name);t&&(delete t[e.id],o.set(e.name,t))}},x.assign(s,o)}),q("SessionStorage.defaults",{name:""}),q("Storage",function(e,t,n){var i=e("CircularJSON"),o={};return function(t){var n=o[t];if(n)return n;var a=`${t}Storage`,s=r[a];if(!s)throw new v(`当前浏览器不支持 ${a} 存储。`);var u=e("KISP"),l=`KISP.${u.name}.(${u.version}).${u.md5}`,c=s.getItem(l)||"{}",f=i.parse(c)||{};function d(){c=i.stringify(f),s.setItem(l,c)}return o[t]={set:function(e,t){f[e]=t,d()},get:function(e){return f[e]},remove:function(e){delete f[e],d()},clear:function(){f={},d()}}}}),q("CircularJSON",function(e,t,n){var r="~",i="\\x"+("0"+r.charCodeAt(0).toString(16)).slice(-2),o="\\"+i,a=new S(i,"g"),s=new S(o,"g"),u=new S("(?:^|([^\\\\]))"+o),l=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},c=C;function f(e,t,n){return t instanceof h?function(e,t,n){for(var r=0,i=t.length;r<i;r++)t[r]=f(e,t[r],n);return t}(e,t,n):t instanceof c?t.length?n.hasOwnProperty(t)?n[t]:n[t]=function(e,t){for(var n=0,i=t.length;n<i;e=e[t[n++].replace(s,r)]);return e}(e,t.split(r)):e:t instanceof x?function(e,t,n){for(var r in t)t.hasOwnProperty(r)&&(t[r]=f(e,t[r],n));return t}(e,t,n):t}var d={stringify:function(e,t,n,s){return d.parser.stringify(e,function(e,t,n){var s,u,c=!1,f=!!t,d=[],h=[e],p=[e],g=[n?r:"[Circular]"],v=e,m=1;return f&&(u="object"==typeof t?function(e,n){return""!==e&&t.indexOf(e)<0?void 0:n}:t),function(e,t){return f&&(t=u.call(this,e,t)),c?(v!==this&&(s=m-l.call(h,this)-1,m-=s,h.splice(m,h.length),d.splice(m-1,d.length),v=this),"object"==typeof t&&t?(l.call(h,t)<0&&h.push(v=t),m=h.length,(s=l.call(p,t))<0?(s=p.push(t)-1,n?(d.push((""+e).replace(a,i)),g[s]=r+d.join(r)):g[s]=g[0]):t=g[s]):"string"==typeof t&&n&&(t=t.replace(i,o).replace(r,i))):c=!0,t}}(e,t,!s),n)},parse:function(e,t){return d.parser.parse(e,function(e){return function(t,n){var a="string"==typeof n;return a&&n.charAt(0)===r?new c(n.slice(1)):(""===t&&(n=f(n,n,{})),a&&(n=n.replace(u,"$1"+r).replace(o,i)),e?e.call(this,t,n):n)}}(t))},parser:y};return d}),q("LocalStorage",function(e,t,n){var r=e("Storage"),i=e("Defaults"),o=r("local"),a=new w;function s(e,n){var r=(n=i.clone(t.id,n)).name;if(!r)throw new v(`KISP.${t.id} 是针对多个应用的存储，每个应用都有自己独立的存储空间。\n                请先指定所在应用的名称(通过配置 ${t.id} 模块的 name 字段) 。`);var o={name:r,id:e};a.set(this,o)}return s.prototype={constructor:s,set:function(e,t){var n=a.get(this),r=o.get(n.name)||{},i=r[n.id]||{};"object"==typeof e?x.assign(i,e):i[e]=t,r[n.id]=i,o.set(n.name,r)},get:function(e){var t=a.get(this),n=(o.get(t.name)||{})[t.id];if(n)return 0==arguments.length?n:n[e]},remove:function(e){var t=a.get(this),n=o.get(t.name)||{},r=n[t.id];r&&(delete r[e],o.set(t.name,n))},clear:function(){var e=a.get(this),t=o.get(e.name);t&&(delete t[e.id],o.set(e.name,t))}},x.assign(s,o)}),q("LocalStorage.defaults",{name:""}),q("App/Navigator/Views",function(e,t,n){var r=e("Tasks"),i=e("Array"),o=e("Package"),a={};return{load:function(e,t,n){var s=function(e){return e=h.isArray(e)?e:[e],e=i.map(e,function(e){return e?("string"==typeof e&&(e={view:e,args:[]}),e):null})}(e),u=t.module,l=t.container,c=new r(s);c.on("each",function(e,t,n){var r=e.view,i=u.require(r);i?n(i):o.load(r,function(e){if(!e)throw new v(`总包中不存在名为 ${r} 的配置节点。`);var t=(e.html||{}).content;!a[r]&&l&&t&&(a[r]=!0,k(l).append(t));var i=u.require(r);if(!i)throw new v(`不存在名为 ${r} 的视图模块`);n(i)})}),c.on("all",function(e){n&&n(...e)}),c.parallel()}}}),q("Package",function(e,t,n){e("$");var r=e("Tasks"),i=e("Session"),o=e("Defaults"),a=t.require("All"),s=t.require("Loader"),u=o.clone(t.id),c={},f=null,d=`KISP.${t.id}.${i.id}`;return{load:function(t,n){if("function"==typeof t)return n=t,void a.load(u,n);var i=c[t];if(i||null===i)n&&n(i);else{var o={done:n},h=`${t}@${d}`;r.todo(h,o,function(n){!function(t,n,r){var i=n.load||{},o=i.begin,u=i.end;o&&(f=o(e,f)),a.load(n,function(i){var o=i[t];if(!o)return l.warn(`总包  ${n.url} 中不存在名为 ${t} 的配置节点。`),u&&u(e,f),void(r&&r(null));s.load(o,function(t){u&&u(e,f),r&&r(t)})})}(t,u,function(e){c[t]=e?x.assign({},e,{cache:!0}):null,n(function(t){t.done(e)})})})}}}}),q("Package.defaults",{url:"packages/all.json",random:!0,query:null,load:{begin:function(e,t){t||(t=new(e("Loading")));return t.show(),t},end:function(e,t){t.hide()}}}),q("Loading",function(e,t,n){var r=e("String"),i=e("Emitter"),o=e("Defaults"),a=t.require("Sample"),s=t.require("Style"),u=t.require("Meta"),l=t.require("Masker"),c=t.require("Presettings"),d=new w;function h(e){var n=c[(e=e||{}).presetting]||{},r=o.clone(t.id,n,e),f=new i(this),h=a.get(r.sample),p=s.get(r),g=l.create(r),v=u.create(r,{sample:h,style:p,emitter:f,masker:g,this:this});d.set(this,v),x.assign(this,{id:v.id})}return h.prototype={constructor:h,id:"",$:null,render:function(){var t=d.get(this);if(!t.$){e("Style");var n=r.format(t.sample,{id:t.id,text:t.text,textId:t.textId,cssClass:t.cssClass});k(t.container).append(n),t.$=this.$=k(`#${t.id}`),t.$text=k(`#${t.textId}`),t.$.css(t.style),t.emitter.fire("render")}},show:function(e,t){"function"==typeof e&&(t=e,e=j);var n=d.get(this),r=n.masker,i=n.duration;n.$||this.render(),r&&r.show(),"string"==typeof e&&(n.text=e,n.$text.html(e)),i&&f(function(){n.this.hide(),t&&t()},i),n.$.toggleClass("NoText",!n.text),n.$.show(),n.emitter.fire("show")},hide:function(){var e=d.get(this),t=e.masker;e.$&&(t&&t.hide(),e.$.hide(),e.emitter.fire("hide"))},remove:function(){var e=d.get(this);if(e.$){var t=e.$.get(0),n=e.masker;t.parentNode.removeChild(t),n&&n.remove(),e.$.off(),e.$=this.$=null,e.$text=null,e.masker=null,e.emitter.fire("remove")}},on:function(...e){d.get(this).emitter.on(...e)},destroy:function(){var e=d.get(this);this.remove(),e.emitter.destroy(),d.remove(this)}},h}),q("Loading.defaults",{text:"处理中...",mask:!1,sample:"IOS",container:"body",duration:0,cssClass:"","z-index":1024,width:"",height:"",style:{}}),q("Style",function(e,t,n){var r=e("Object");function i(e){if("number"==typeof e)return e+"px";if("string"==typeof e){var t=/^\d+px$/g.test(e),n=/^\d+em$/g.test(e),r=/^\d+rem$/g.test(e),i=/^\d+%$/g.test(e);if(t||n||r||i)return e;var o=parseInt(e);return isNaN(o)?e:o+"px"}return e}return n={objectify:function(e){if(!e)return{};if("object"==typeof e)return e;if("string"!=typeof e)return{};var t={};return e.split(";").forEach(function(e){if(e=(e=e.trim()).replace(/\n/g,"")){var n=e.split(":"),r=n[0].trim(),i=n[1].trim();t[r]=i}}),t},stringify:function(e,t,i){if(!e)return"";"string"==typeof e&&(e=n.objectify(e)),"number"==typeof t&&(i=t,t=null);var o=[];return r.each(e,function(e,n){if(null!=(n=t?t(e,n):n)&&""!==n){var r=e+": "+n;i&&(r=new h(i+1).join(" ")+r),o.push(r)}}),0==o.length?"":e=i?o.join("; \n")+"; \n":o.join("; ")+"; "},pixelize:function(e,t){return"object"==typeof e||t?(t=t||[],e=n.objectify(e),e=r.map(e,function(e,n){return t.includes(e)?i(n):n})):i(e)},trim:function(e){var t={};return r.each(e,function(e,n){null!=n&&""!==n&&(t[e]=n)}),t},merge:function(...e){return e=e.map(function(e){return e?e=n.trim(e):{}}),x.assign(...e)}}}),q("Loading/Sample",function(e,t,n){return{get:function(e){return t.require(e)}}}),q("Loading/Style",function(e,t,n){var r=e("Object"),i=e("Style");return{get:function(e){var t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),q("Loading/Meta",function(e,t,n){e("$"),e("String");var r=e("RandomId");return{create:function(e,t){var n={id:r.get("KISP-Loading-",4),textId:r.get("KISP-Loading-","text-",4),text:e.text||"",cssClass:e.cssClass||"",container:e.container,duration:e.duration||0,sample:"",masker:null,style:null,emitter:null,this:null,$:null,$text:null};return x.assign(n,t),n}}}),q("RandomId",function(e,t,n){var r=e("String");return{get:function(...e){return(e=e.map(function(e,t){return"number"==typeof e&&(e=(e=r.random(e)).toLowerCase()),e})).join("")}}}),q("Loading/Masker",function(e,t,n){e("$");return{create:function(t){var n=e("Mask"),r={container:t.container},i=n.normalize(r,t.mask);if(!i)return null;var o=new n(i),a=t["z-index"]-1;return o.on("render",function(){o.$.css({"z-index":a})}),o}}}),q("Mask",function(e,t,n){var r=e("Emitter"),i=e("String"),o=e("Defaults"),a=t.require("Sample"),s=t.require("Style"),u=t.require("Meta"),l=new w;function c(e){e=o.clone(t.id,e);var n=new r(this),i=s.get(e),c=u.create(e,{sample:a,style:i,emitter:n,this:this});l.set(this,c),x.assign(this,{id:c.id})}return c.prototype={constructor:c,id:"",$:null,render:function(){var t=l.get(this);if(!t.$){var n=e("Style").stringify(t.style),r=i.format(t.sample,{id:t.id,style:n});k(t.container).append(r),this.$=t.$=k(`#${t.id}`),t.bindVolatile(function(){if(!1!==t.this.hide()){var e=t.$.css("opacity");t.$.css("opacity",0),t.this.show({quiet:!0}),f(function(){t.$.css("opacity",e),t.$.hide()},200)}}),t.emitter.fire("render")}},show:function(e){e=e||{};var t=l.get(this),n="duration"in e?e.duration:t.duration,r="fadeIn"in e?e.fadeIn:t.fadeIn;t.$||this.render(),n&&f(function(){t.this.hide()},n),r&&t.$.css("opacity",0),t.$.show(),r&&t.$.animate({opacity:t.opacity},r),e.quiet||t.emitter.fire("show")},hide:function(e){e=e||{};var t=l.get(this),n="fadeOut"in e?e.fadeOut:t.fadeOut;if(t.$){if(t.emitter.fire("hide").includes(!1))return!1;n?t.$.animate({opacity:0},n,function(){t.$.css("opacity",t.opacity),t.$.hide()}):t.$.hide()}},remove:function(){var e=l.get(this);if(e.$){var t=e.$.get(0);t.parentNode.removeChild(t),e.$.off(),this.$=e.$=null,e.emitter.fire("remove")}},on:function(...e){l.get(this).emitter.on(...e)},destroy:function(){var e=l.get(this);this.remove(),e.emitter.destroy(),l.delete(this)}},x.assign(c,{normalize:function(e,t){if(!1===t)return null;"number"==typeof e&&(e={opacity:e}),"number"==typeof t&&(t={opacity:t});var n=typeof e,r=typeof t;return"object"==n&&"object"==r?x.assign({},e,t):!0===t?e&&"object"==n?e:{}:t===j?"object"==n?e:e?{}:null:"object"==r?t:t?{}:null}}),c}),q("Mask.defaults",{volatile:!1,container:"body",eventName:"click",duration:0,fadeIn:0,fadeOut:0,cssClass:"",opacity:.5,"z-index":1024,style:{}}),q("Mask.config",{eventName:"click",style:{position:"fixed"}}),q("Mask/Sample",['<div id="{id}" class="KISP Mask" style="{style} display: none;"></div>'].join("\n")),q("Mask/Style",function(e,t,n){var r=e("Object"),i=e("Style");return{get:function(e){var t=r.filter(e,["opacity","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t)}}}),q("Mask/Meta",function(e,t,n){e("$"),e("String");var r=e("RandomId");return{create:function(e,t){var n=r.get("KISP-Mask-",4),i=e.eventName,o=e.volatile,a={id:n,sample:"",eventName:i,volatile:o,container:e.container,duration:e.duration,fadeIn:e.fadeIn,fadeOut:e.fadeOut,opacity:e.opacity,emitter:null,style:null,this:null,$:null,bindVolatile:function(e){o&&("touch"==i?a.$.touch(e):a.$.on(i,e))}};return x.assign(a,t),a}}}),q("Loading/Presettings",{fullscreen:{cssClass:"FullScreen"},"scroller.pulldown":{sample:"IOS",cssClass:"SameLine Pulldown",text:"加载中..."},"scroller.pullup":{sample:"IOS",cssClass:"SameLine Pullup",text:"加载中..."}}),q("Session",function(e,t,n){var r=e("String"),i=e("Defaults").get(t.id).length||16;return{id:r.random(i)}}),q("Session.defaults",{length:16}),q("Package/All",function(e,t,n){var r=e("$"),i=e("Query"),o=e("Url"),a=e("Tasks"),s=e("Session"),u=`all@KISP.${t.id}.${s.id}`,l=null;function c(e,t){var n=function(e){var t=o.root()+e.url,n=e.query;return"string"==typeof n&&(n=i.parse(n)),n&&(t=i.add(t,n)),e.random&&(t=i.random(t,4)),t}(e);r.ajax({type:"get",dataType:"json",url:n,error:function(){l={},t&&t(l)},success:function(e){l=e,t&&t(l)}})}return{load:function(e,t){l?t&&t(l):a.todo(u,t,function(t){c(e,function(e){t(function(t){t&&t(e)})})})}}}),q("Package/Loader",function(e,t,n){var r=e("Tasks");var o={css:function(e,t){var n=i.createElement("link");n.onerror=function(){throw new v(`css 文件加载失败: ${e}`)},n.onload=function(){t&&t({url:e,content:""})},n.rel="stylesheet",n.href=e,i.head.appendChild(n)},html:function(e,t){k.ajax({type:"get",url:e,dataType:"html",cache:!0,error:function(e,t,n){throw n},success:function(n,r,i){t&&t({url:e,content:n})}})},js:function(e,t){k.ajax({type:"get",url:e,dataType:"script",cache:!0,error:function(e,t,n){throw n},success:function(n,r,i){t&&t({url:e,content:n})}})},json:function(e,t){k.ajax({type:"get",dataType:"json",url:e,error:function(){t&&t({})},success:function(e){t&&t(e)}})}};return{load:function(e,t){var n=x.keys(e);r.parallel(n,{each:function(t,n,r){var i=e[t],a=o[t];if(!a)throw new v(`不支持加载 ${t} 类型的文件。`);a(i,function(e){r({type:t,url:e.url,content:e.content})})},all:function(e){var n={cache:!1};e.forEach(function(e){n[e.type]=e}),t&&t(n)}})}}}),q("View",function(e,t,n){var r=e("Defaults"),i=e("Panel"),o=r.get(t.id);e("Mapper");function a(e,n){n=r.clone(t.id,n),i.call(this,e,n),this.$.addClass("KISP View"),n.fullscreen&&this.$.addClass("FullScreen"),n.background&&this.$.css("background",n.background)}return a.prototype=x.assign(new i,{}),x.assign(a,{define:function(e,t){i.define(e,t,{constructor:a,defaults:o})},update:function(e){i.update(e,{defaults:o})}})}),q("View.defaults",{container:'[data-view="{id}"]',background:"",fullscreen:!1}),q("View.config",{fullscreen:!1}),q("Panel",function(e,t,n){var r=e("Object"),i=e("Emitter"),o=e("Defaults"),a=e("OuterModule"),s=e("Template"),u=t.require("Meta"),c=t.require("Container"),f=t.require("Params"),d=e("Mapper"),p={},g=o.clone(t.id);function m(e,n){n=o.clone(t.id,n);var r=u.create(n,{moudle:null,container:e,tplContainer:e,$emitter:new i,emitter:new i(this),$:k(e),this:this});d.set(this,r),x.assign(this,{container:e,id:r.id,$:r.$})}return m.prototype={constructor:m,container:"",id:"",$:null,module:null,render:function(...e){var t=d.get(this),n=t.emitter;t.renderArgs=e,t.rendered||(t.rendered=!0,n.fire("init")),n.fire("before-render",e),n.fire("render",e),t.show&&this.show(),n.fire("after-render",e)},show:function(...e){var t=d.get(this);return t.$.show(...e),t.visible=!0,t.emitter.fire("show")},hide:function(...e){var t=d.get(this);return t.$.hide(...e),t.visible=!1,t.emitter.fire("hide")},toggle:function(e){var t=d.get(this);return 0==arguments.length?t.visible?this.hide():this.show():e?this.show():this.hide(),t.visible},template:function(e){var t=d.get(this),n=t.tpl;return n||(n=t.tpl=new s(t.tplContainer)),e&&n.process(...arguments),n},fill:function(e,t){var n=d.get(this);return this.template(),n.tpl.render(e,t),n.emitter.fire("fill",[e])},refresh:function(){var e=d.get(this),t=e.renderArgs;return this.render(...t),e.emitter.fire("refresh",t)},reset:function(...e){return d.get(this).emitter.fire("reset",e)},close:function(...e){return d.get(this).emitter.fire("close",e)},visible:function(){return d.get(this).visible},rendered:function(){return d.get(this).rendered},fire:function(...e){return d.get(this).$emitter.fire(...e)},$on:function(e,t,n){var i=f.normalize(e,t,n);if(i){var o=d.get(this);r.each(i,function(e,t){t&&("function"!=typeof t?r.each(t,function(t,n){o.$.on(e,t,n)}):o.$.on(e,t))})}},$bind:function(e,t){var n=null;if("string"==typeof e)n={[e]:t};else{if("object"!=typeof e)throw new v("无法识别参数 selector 的类型。");n=e}if(n){var i=d.get(this);r.each(n,function(e,t){t&&r.each(t,function(t,n){i.$.on(t,e,n)})})}},wrap:function(e){var t=d.get(this),n=t.panel;if(n)return n;e=e||{},n=t.panel={};var i=new Set(["constructor","fire","wrap"]);return r.each(t.this,function(e,r){i.has(e)||("function"==typeof r&&(r=r.bind(t.this)),n[e]=r)}),x.assign(n,e,{on:t.$emitter.on.bind(t.$emitter),off:t.$emitter.off.bind(t.$emitter)}),n},propagate:function(e,t){var n=d.get(this);t.forEach(function(t){e.on(t,function(...e){n.this.fire(t,e)})})},set:function(e,t){var n=d.get(this);if(r.isPlain(e))r.each(e,function(e,t){n.this.set(e,t)});else switch(e){case"show":case"rendered":n[e]=t;break;case"$":case"container":c.set(n,t);break;case"visible":n.visible=!!t;break;case"template":if(n.tpl)throw new v("当前实例中已创建了模板实例，无法再修改模板实例所关联的 DOM 容器。");n.tplContainer=n.$.find(t);break;default:throw new v(`目前不支持设置属性: ${e}`)}},destroy:function(){var e=d.get(this);e.emitter.destroy(),e.$emitter.destroy(),e.$.off(),d.delete(this)},on:function(...e){d.get(this).emitter.on(...e)}},x.assign(m,{define:function(e,t,n){n=n||{constructor:m,defaults:g},a.define(e,function(r,i,o){var a=c.get(e,n.defaults),s=new n.constructor(a);return d.get(s).module=s.module=i,o=t(r,i,s),o=s.wrap(o),p[e]=s,o})},update:function(e,t){e=h.isArray(e)?e:[e],t=t||{defaults:g},e.forEach(function(e){var n=p[e],r=c.get(e,t.defaults);n?n.set("container",r):l.warn(`不存在 ${r} 的 Panel 实例。`)})}}),m}),q("Panel.defaults",{container:'[data-panel="{id}"]',show:!0}),q("Template",function(e,t,n){var r=e("String"),i=e("Object"),o=e("Emitter"),a=t.require("Meta"),s=t.require("Parser"),u=t.require("Sample"),c=t.require("Child"),f=new w;function d(e){var t=i.isPlain(e),n=a.create({emitter:new o(this),this:this});if(f.set(this,n),t){var r=e;a.assign(n,r),n.tpls=r.items.map(function(e){return c.create(d,n,e)})}else{var l=k(e).get(0);if(!l)throw e=e instanceof k?e.selector:e,new v("不存在模板节点: "+e);var h="template"==l.nodeName.toLowerCase(),p=l.innerHTML,g=s.parse(p);n.sample=u.between(p),n.name=h?l.getAttribute("name"):"",n.placeholder=h?l.getAttribute("placeholder"):"",n.innerHTML=p,n.outerHTML=l.outerHTML,n.node=l,n.tpls=g.tpls.map(function(e){var t=c.create(d,n,e),r=n.sample;return n.sample=u.replace(r,e),t})}!function(){var e=n.name$tpl[""];if(e){var t=f.get(e);if(x.keys(t.name$tpl).length>0)throw new v("无名称的 template 标签下不能再嵌套子级 template。");if(t.placeholder)throw new v("无名称的 template 标签不能设置 placeholder 属性。");n.sample=t.sample}}(),x.assign(this,{id:n.id,_meta:n})}return d.prototype={constructor:d,id:"",parent:null,template:function(e){h.isArray(e)||(e=[...arguments]);var t=this,n=f.get(t);return e.map(function(e){t=n.name$tpl[e],n=f.get(t)}),t},sample:function(...e){var t=this.template(...e),n=f.get(t);if(!n)throw new v(`当前实例下不存在名称路径为 ${e.join(" ")} 的 Template 子实例。`);return n.sample},get:function(e){var n=f.get(this);switch(l.warn(`${t.id} 类的实例 get 方法已过时，请不要使用。`),e){case"name":case"sample":return n[e]}},render:function(e,t){t&&this.process(t);var n=f.get(this).node,r=this.fill(e);return n&&(n.innerHTML=r),r},fill:function(e,...t){var n=[...arguments],o=n.findIndex(function(e){return h.isArray(e)||i.isPlain(e)});if(o<0)throw new v("填充模板时必须指定数据为一个数组或纯对象。");if(o>0){var a=n.slice(0,o),s=this.template(...a);if(!s)throw new v(`不存在路径为 ${a.join(".")} 的模板节点，请检查 html 模板树。`);var u=n.slice(o);return s.fill(...u)}var l=f.get(this);return h.isArray(e)?e.map(function(e,n){var i=[e,n,...t];l.emitter.fire("process",i);var o=l.process.apply(l.this,i);return"string"==typeof o?o:o?r.format(l.sample,o):""}).join(""):(l.emitter.fire("process",n),"string"==typeof(e=l.process.apply(l.this,n))?e:r.format(l.sample,e))},process:function(e){var t=f.get(this);if("function"!=typeof e){var n=[...arguments],r=n.findIndex(function(e){return"function"==typeof e||i.isPlain(e)});if(r<0)throw new v(`模板节点 ${t.name} 缺少处理器。`);if(r>0){var o=n.slice(0,r),a=n[r];e=i.make({},o,a)}i.flat(e).forEach(function(e){var n=e.keys.filter(function(e){return!!e}),r=e.value;if("function"!=typeof r)throw new v(`模板节点 ${n.join(".")} 的处理器必须为一个函数。`);var i=t.this.template(n);i?i.process(r):l.warn(`不存在模板节点: ${n.join(".")}`)})}else t.process=e},fix:function(e){var t=f.get(this),n=t.sample;(e=h.isArray(e)?e:[e]).map(function(e){var t="{"+e+"}",r=t+'=""';n=n.split(r).join(t)}),t.sample=n},on:function(...e){f.get(this).emitter.on(...e)},destroy:function(){var e=f.get(this);e&&(e.tpls.map(function(e){e.destroy()}),e.emitter.destroy(),e.node=null,e.parent=null,e.emitter=null,f.delete(this))}},x.assign(d,{create:function(t){return t=`<template>${t}</template>`,new d(e("HTMLParser").parse(t).childNodes[0])}}),d}),q("HTMLParser",function(e,t){var n={},r={},o=/([a-z0-9_\:\-]*)\s*?=\s*?(['"]?)(.*?)\2\s+/gim,a=/(?:<(\/?)([a-zA-Z][a-zA-Z0-9\:]*)(?:\s([^>]*?))?((?:\s*\/)?)>|(<\!\-\-)([\s\S]*?)(\-\->)|(<\!\[CDATA\[)([\s\S]*?)(\]\]>))/gm;function s(){this.childNodes=[]}function u(){}function c(){s.call(this)}function f(){}function d(){}function p(){}return r.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},r.inherit=function(e,t){var n=e.prototype;function i(){}i.prototype=t.prototype,e.prototype=new i,r.extend(e.prototype,n),e.prototype.constructor=e},r.selfClosingTags=["area","base","br","col","embed","frame","hr","img","input","keygen","link","meta","object","param","source"],r.getElementsByTagName=function(e,t){var n,i,o=[],a=0;if(t||(t="*"),t=t.toLowerCase(),e.childNodes)for(n=0;n<e.childNodes.length;n++)1!==(i=e.childNodes[n]).nodeType||"*"!==t&&i.nodeName!==t||(o[a++]=i),h.prototype.splice.apply(o,[o.length,0].concat(r.getElementsByTagName(i,t))),a=o.length;return o},r.splitAttrs=function(e){var t,n={};if(e)for(o.lastIndex=0,e=" "+(e||"")+" ";t=o.exec(e);)n[t[1]]=t[3];return n},r.ta=i.createElement("textarea"),r.encodeEntities=function(e){return r.ta.value=e||"",r.ta.innerHTML},r.decodeEntities=function(e){return r.ta.innerHTML=e||"",r.ta.value},r.htmlToText=function(e){return e=e.replace(/<\/?[a-z].*?>/gim,""),r.decodeEntities(e)},r.extend(s.prototype,{nodeType:1,textContent:"",getElementsByTagName:function(e){return r.getElementsByTagName(this,e)},getAttribute:function(e){if(this.attributes.hasOwnProperty(e))return this.attributes[e]},setAttribute:function(e,t){var n=(e+"").toLowerCase();this.attributes[e]=t+"","id"!==n&&"name"!==n||(this[n]=t),"class"===n&&(this.className=t)},getElementById:function(e){var t,n=this.getElementsByTagName("*");for(t=n.length;t--;)if(n[t].id===e)return n[t]},appendChild:function(e){e.parentNode&&e.parentNode.removeChild(e),this.childNodes.push(e)},insertBefore:function(e,t){e.parentNode&&e.parentNode.removeChild(e);for(var n=0;n<this.childNodes.length&&this.childNodes[n]!==t;n++);this.childNodes.splice(n,0,e)},removeChild:function(e){for(var t=this.childNodes.length;t--;)if(this.childNodes[t]===e){this.childNodes.splice(t,1);break}}}),n.HTMLElement=s,r.extend(u.prototype,{toString:function(){return this.textContent}}),r.inherit(c,s),r.extend(c.prototype,{nodeType:9,nodeName:"#document"}),n.Document=c,r.inherit(f,u),r.extend(f.prototype,{nodeType:3,nodeName:"#text"}),n.TextNode=f,r.inherit(d,u),r.extend(d.prototype,{nodeType:8,nodeName:"#comment"}),n.CommentNode=d,r.inherit(p,u),r.extend(p.prototype,{nodeType:4,nodeName:"#cdata-section"}),n.CDATASectionNode=p,r.blockConstructors={"\x3c!--":d,"<![CDATA[":p},n.parse=function(e){var t,n,i,o,u,d,h,p,g,v,m,y,w;for(t=[],a.lastIndex=0,i=n=new c,y=function(){i&&t.length>0&&(o=t[t.length-1],h=(o.documentPosition.closeTag||o.documentPosition.openTag).end,o.parentNode===i&&h&&h<w.documentPosition.openTag.start&&(d=e.substring(h,w.documentPosition.openTag.start))&&(d=r.decodeEntities(d),i.childNodes.push(r.extend(new f,{textContent:d,nodeValue:d,parentNode:i}))))};u=a.exec(e);)p=u[5]||u[8],g=u[6]||u[9],v=u[7]||u[10],"\x3c!--"===p||"<![CDATA["===p?(h=a.lastIndex-u[0].length,(m=r.blockConstructors[p])&&(w=r.extend(new m,{textContent:g,nodeValue:g,parentNode:i,documentPosition:{openTag:{start:h,end:h+p.length},closeTag:{start:a.lastIndex-v.length,end:a.lastIndex}}}),y(),t.push(w),w.parentNode.childNodes.push(w))):"/"!==u[1]?((w=r.extend(new s,{nodeName:(u[2]+"").toLowerCase(),attributes:r.splitAttrs(u[3]),parentNode:i,documentPosition:{openTag:{start:a.lastIndex-u[0].length,end:a.lastIndex}}})).className=w.attributes.class,w.id=w.attributes.id,w.name=w.attributes.name,y(),t.push(w),w.parentNode.childNodes.push(w),u[4]&&u[4].indexOf("/")>-1||r.selfClosingTags.includes(w.nodeName)?(w.documentPosition.closeTag=w.documentPosition.openTag,w.isSelfClosingTag=!0,w.innerHTML="",w.outerHTML=e.substring(w.documentPosition.openTag.start,w.documentPosition.closeTag.end)):i=w):(u[2]+"").toLowerCase()===i.nodeName?(i=(w=i).parentNode,delete w.isSelfClosingTag,w.documentPosition.closeTag={start:a.lastIndex-u[0].length,end:a.lastIndex},w.innerHTML=e.substring(w.documentPosition.openTag.end,w.documentPosition.closeTag.start),w.outerHTML=e.substring(w.documentPosition.openTag.start,w.documentPosition.closeTag.end),w.textContent=r.htmlToText(w.innerHTML)):(u[2]+"").toLowerCase()===t[t.length-1].nodeName&&!0===t[t.length-1].isSelfClosingTag?(w=t[t.length-1],l.warn("HTML Error: discarding dangling </"+u[2]+"> tag. Already closed via: "+w.outerHTML),delete w.isSelfClosing,w.documentPosition.closeTag={start:a.lastIndex-u[0].length,end:a.lastIndex}):l.warn('tag mismatch: "'+u[2]+'" vs "'+w.nodeName+'"',w);return n.documentElement=n.getElementsByTagName("html")[0],n.body=n.getElementsByTagName("body")[0],n},n}),q("Template/Meta",function(e,t,n){e("String"),e("Object");var r=e("RandomId");function i(e){return e}return{create:function(e){var t={id:r.get("KISP-Template-",4),sample:"",name:"",placeholder:"",innerHTML:"",outerHTML:"",tpls:[],name$tpl:{},node:null,parent:null,emitter:null,this:null,process:i};return x.assign(t,e),t},assign:function(e,t){x.assign(e,{sample:t.sample,name:t.name,placeholder:t.placeholder,innerHTML:t.innerHTML,outerHTML:t.outerHTML,node:t.node})}}}),q("Template/Parser",function(e,t,n){var r=e("HTMLParser"),i=t.require("Templates");return{parse:function(e){e=(e=e.split('<script type="text/template">').join("")).split("<\/script>").join("");var t=r.parse(e);return{dom:t,tpls:i.get(t)}}}}),q("Template/Parser/Templates",function(e,t,n){e("String"),e("Object");return{get:function(e){var t=e.getElementsByTagName("template"),n=new w;return t.map(function(e){var t=e.attributes,r=e.innerHTML,i={id:e.id||"",name:e.name||"",placeholder:t.placeholder||"",innerHTML:r,outerHTML:e.outerHTML,node:e,sample:r,parent:null,attributes:t,items:[]};return n.set(e,i),i}).filter(function(e){var t=function(e){for(e=e.parentNode;e;){if("template"==e.nodeName)return e;e=e.parentNode}return null}(e.node),r=n.get(t);if(!r)return!0;e.parent=r,r.items.push(e);var i=r.sample,o=e.outerHTML,a=e.placeholder;a&&(a="{"+a+"}"),r.sample=i.replace(o,a)})}}}),q("Template/Sample",function(e,t,n){var r=e("String");e("Object");return{replace:function(e,t){var n=t.outerHTML,r=t.placeholder;return r&&(r="{"+r+"}"),e=(e=(e=e.split('<script type="text/template">').join("")).split("<\/script>").join("")).replace(n,r)},between:function(e){return e.includes("\x3c!--")&&e.includes("--\x3e")&&(e=r.between(e,"\x3c!--","--\x3e")),e}}}),q("Template/Child",function(e,t,n){e("String"),e("Object");return{create:function(e,t,n){var r=n.name;if(t.name$tpl[r])throw new v("同一级下已存在名为 `"+r+"` 的模板。");var i=new e(n);return t.name$tpl[r]=i,t.parent=t.this,i.parent=t.this,i.on("process",function(){var e=h.from(arguments);t.emitter.fire("process",e)}),i}}}),q("Mapper",function(e,t,n){return new w}),q("Panel/Meta",function(e,t,n){e("$"),e("String");var r=e("RandomId");return{create:function(e,t){var n={id:r.get("KISP-Panel-",4),container:"",rendered:!1,renderArgs:[],show:e.show,visible:!1,tplContainer:null,module:null,$:null,$emitter:null,emitter:null,tpl:null,panel:null,this:null};return x.assign(n,t),n}}}),q("Panel/Container",function(e,t,n){var r=e("String");e("Defaults");return{get:function(e,t){return r.format(t.container,{id:e})},set:function(e,t){if(!(t=t||e.$.selector)&&e.module&&(t=e.container),!t)throw new v("设置 container 时，请给参数 value 提供一个有效的值。");e.container=t,e.$.off(),e.$=e.this.$=k(e.container),e.panel&&(e.panel.$=e.$);var n=e.$.find.bind(e.$);e.$.find=function(...e){var t=n(...e);return t.each(function(e){i.documentElement.contains(this)||this.parentNode.removeChild(this)}),t=n(...e)}}}}),q("Panel/Params",function(e,t,n){e("$");var r=e("String"),i=e("Object");return{normalize:function(e,t,n){var o=typeof e;if("object"==o)return e;if("string"!=o)throw new v("无法识别参数 name 的类型。");if("object"==(o=typeof t)||"function"==o)return{[e]:t};if("string"!=o)throw new v("无法识别参数 sample 的类型。");if("function"==(o=typeof n))return{[e]:{[t]:n}};if("object"==o){var a={};return i.each(n,function(e,n){e=r.format(t,{value:e}),a[e]=n}),{[e]:a}}throw new v("无法识别参数 selector$fn 的类型。")}}}),q("Alert",function(e,t,n){var r=e("String"),i=t.require("Dialog"),o=t.require("Sample");return{show:function(e,t,n,a){"object"==typeof e&&(e=y.stringify(e,null,4),e=r.format(o,{text:e}));var s=[...arguments],u=s.findIndex(function(e,t){return"function"==typeof e});u>0?(a=s[u],s=s.slice(0,u)):a=null,e=r.format(...s),i.add(e,a)}}}),q("Alert.defaults",{volatile:!1,mask:!0,autoClose:!0,width:"80%","z-index":99999,buttons:[{text:"确定",cmd:"ok",cssClass:"OK"}]}),q("Alert.config",{width:450}),q("Alert/Dialog",function(e,t,n){e("String");var r=e("Defaults"),o=t.require("Height"),a=null,s=!1,u=[],l=13;function c(n,f){var d=o.get(n);(a=a||function(){var n=e("Dialog"),o=r.clone(t.parent.id),a=new n({cssClass:"Alert",volatile:o.volatile,mask:o.mask,autoClose:o.autoClose,width:o.width,"z-index":o["z-index"],buttons:o.buttons,scrollable:o.scrollable});return a.on("button",{ok:function(){var e=a.data("fn");e&&e()}}),a.on({show:function(){s=!0,l=13==l?"enter":"",i.activeElement.blur()},hide:function(){s=!1;var e=u.shift();e&&c(e.text,e.fn),null,l=""}}),k(i).on({keydown:function(e){l=e.keyCode},keyup:function(e){if(13==e.keyCode&&s&&"enter"!=l){a.hide();var t=a.data("fn");t&&t()}}}),a}()).data("fn",f),a.set({content:n,height:d}),a.show()}return{add:function(e,t){s?u.push({text:e,fn:t}):c(e,t)}}}),q("Dialog",function(e,t,n){var r=e("Object"),i=e("Emitter"),o=e("Defaults"),a=t.require("Style"),s=t.require("Meta"),u=t.require("Masker"),l=t.require("Events"),c=t.require("Template"),f=e("Mapper");function d(e){e=o.clone(t.id,e);var n=new i(this),r=a.get(e),l=u.create(e),c=s.create(e,{style:r,emitter:n,masker:l,this:this});f.set(this,c),x.assign(this,{id:c.id})}return d.prototype={constructor:d,id:"",$:null,render:function(){var e=f.get(this);if(!e.$){var t=c.fill(e);k(e.container).append(t),e.$=this.$=k(`#${e.id}`),e.$header=k(`#${e.headerId}`),e.$article=k(`#${e.articleId}`),e.$content=k(`#${e.contentId}`),e.$footer=k(`#${e.footerId}`),l.bind(e),e.emitter.fire("render")}},show:function(){var e=f.get(this);e.emitter;e.visible?e.scroller&&e.scroller.refresh(200):(e.$||this.render(),e.$.show(),e.visible=!0,e.masker&&e.masker.show(),e.scroller&&e.scroller.refresh(200),e.emitter.fire("show"))},hide:function(){var e=f.get(this);e.$&&e.visible&&(e.$.hide(),e.visible=!1,e.masker&&e.masker.hide(),e.emitter.fire("hide"))},remove:function(){var e=f.get(this);if(e.$){e.masker&&e.masker.remove(),e.layer&&e.layer.remove();var t=e.$.get(0);t.parentNode.removeChild(t),e.$.off(),e.visible=!1,e.masker=null,e.layer=null,e.$=null,e.$header=null,e.$content=null,e.$footer=null,e.emitter.fire("remove")}},on:function(...e){f.get(this).emitter.on(...e)},destroy:function(){var e=f.get(this);if(!e)throw new v("该实例已给销毁，无法再次调用 destroy 方法。");this.remove(),e.emitter.destroy(),e.scroller&&e.scroller.destroy(),f.delete(this)},set:function(e,n){this.render();var i=f.get(this),o=i.scroller,s="object"==typeof e?e:{[e]:n};r.each(s,function(e,n){switch(e){case"title":i.$header.html(n);break;case"content":i.$content.html(n),o&&o.refresh(200);break;case"height":case"width":var r={};r[e]=i[e]=n,r=a.get(r),x.assign(i.style,r),i.$.css(r),o&&o.refresh(300);break;default:throw new v(`${t.id} 目前不支持设置属性: ${e}`)}})},data:function(e,t){var n=f.get(this).data,i=arguments.length;return 0==i?n:r.isPlain(e)?(x.assign(n,e),e):1==i?n[e]:(n[e]=t,t)}},d}),q("Dialog.defaults",{container:"body",mask:!0,autoClose:!0,volatile:!1,title:"",content:"",eventName:"click",cssClass:"","z-index":1024,width:"80%",height:"50%",style:{},buttons:[]}),q("Dialog.config",{scrollable:!1,scroller:null,eventName:"click",width:600}),q("Dialog/Style",function(e,t,n){var r=e("Object"),i=e("Style");return{get:function(e){var t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),q("Dialog/Meta",function(e,t,n){e("$"),e("String");var r=e("RandomId"),i="KISP-Dialog-";return{create:function(e,t){var n=r.get(i,4),o=e.buttons||[];o=o.map(function(e){return"string"==e?{text:e}:e});var a={id:n,headerId:r.get(i,"header-",4),articleId:r.get(i,"article-",4),contentId:r.get(i,"content-",4),footerId:r.get(i,"footer-",4),scrollable:e.scrollable,scrollerConfig:e.scroller,eventName:e.eventName,title:e.title,content:e.content,buttons:o,"z-index":e["z-index"],width:e.width,height:e.height,autoClose:e.autoClose,volatile:e.volatile,cssClass:e.cssClass||"",container:e.container,pressedClass:"Pressed",visible:!1,style:{},data:{},scroller:null,masker:null,emitter:null,this:null,$:null,$header:null,$content:null,$footer:null};return x.assign(a,t),a}}}),q("Dialog/Masker",function(e,t,n){e("$");return{create:function(t){var n=e("Mask"),r={container:t.container},i=n.normalize(r,t.mask);return i?(x.assign(i,{volatile:t.volatile,"z-index":t["z-index"]-1}),new n(i)):null}}}),q("Dialog/Events",function(e,t,n){e("Template"),e("Array"),e("String");return{bind:function(e){e.masker&&e.volatile&&e.masker.on({show:function(){},hide:function(){e.this.hide()}}),function(){if(e.buttons.length){var t=e.$footer,n=e.eventName,r="button[data-index]",i=e.pressedClass;"touch"!=n?(t.on(n,r,o),t.on("mousedown",r,function(e){k(this).addClass(i)}),t.on("mouseup mouseout",r,function(e){k(this).removeClass(i)})):t.touch(r,o,i)}function o(t){var n=+this.getAttribute("data-index"),r=e.buttons[n],i=r.cmd||C(n),o=r.fn;o&&o(r,n),e.emitter.fire("button",i,[r,n]),e.emitter.fire("button",[r,n]);var a=r.autoClose;a===j&&(a=e.autoClose),a&&e.this.hide()}}()}}}),q("Dialog/Template",function(e,t,n){var r=e("Template"),i=(e("Array"),e("String"),e("Style")),o=t.require("Sample"),a=r.create(o);return a.process({"":function(e){var t=this.fill("header",e),n=this.fill("content",e),r=this.fill("footer",e),o=i.stringify(e.style);return{id:e.id,cssClass:e.cssClass||"",style:o,header:t,content:n,footer:r}},header:function(e){var t=e.title;return t?{headerId:e.headerId,title:t}:""},content:function(e){return{articleId:e.articleId,contentId:e.contentId,content:e.content,noHeader:e.title?"":"NoHeader",noFooter:e.buttons.length>0?"":"NoFooter"}},footer:{"":function(e){var t=e.buttons,n=t.length;return n?(t=this.fill("button",t),{footerId:e.footerId,count:n,buttons:t}):""},button:function(e,t){var n=i.stringify(e.style);return{index:t,text:e.text,cssClass:e.cssClass||"",style:n}}}}),a}),q("Dialog/Template/Sample",["",'<div id="{id}" class="KISP Dialog {cssClass}" style="{style} display: none;">','    <template name="header" placeholder="header">','        <header id="{headerId}">',"            {title}","        </header>","    </template>","",'    <template name="content" placeholder="content">','        <article id="{articleId}" class="{noHeader} {noFooter}">','            <div id="{contentId}">{content}</div>',"        </article>","    </template>","",'    <template name="footer" placeholder="footer">','        <footer id="{footerId}" class="Buttons-{count}">','            <template name="button" placeholder="buttons">','                <button data-index="{index}" class="{cssClass}" style="{style}">{text}</button>',"            </template>","        </footer>","    </template>","</div>",""].join("\n")),q("Alert/Dialog/Height",function(e,t,n){var r=e("String");return{get:function(e){var t=function(e){e=C(e);var t=r.getByteLength(e),n=b.max(t,125);return n>=.8*i.documentElement.clientHeight&&(n="80%"),n}(e),n=function(e){var t=25*(e=C(e)).split("\n").length+60;return t>=.8*i.documentElement.clientHeight&&(t="80%"),t}(e),o=b.max(t,n);return"number"==typeof o&&(o=o%2==1?o+1:o),o}}}),q("Alert/Sample",['<pre class="JSON">{text}</pre>'].join("\n")),q("Confirm",function(e,t,n){e("String");var r=e("Defaults"),o=null,a=!1,s=[],u=null,l=13,c=null;function f(n){(o=o||function(){var n=e("Dialog");c=r.clone(t.id);var o=new n({cssClass:t.id,volatile:c.volatile,mask:c.mask,autoClose:c.autoClose,height:c.height,"z-index":c["z-index"],buttons:c.buttons,scrollable:c.scrollable});return o.on("button",{ok:function(){var e=o.data("ok");e&&e()},cancel:function(){var e=o.data("cancel");e&&e()}}),o.on({show:function(){a=!0,l=13==l?"enter":"",(u=i.activeElement).blur(),o.$.find("footer button").get(0).focus()},hide:function(){a=!1;var e=s.shift();e&&f(e),u&&u.focus(),u=null,l=""}}),k(i).on({keydown:function(e){l=e.keyCode},keyup:function(e){if(13==e.keyCode&&a&&"enter"!=l){o.hide();var t=o.data("ok");t&&t()}}}),o}()).data(n),o.set({content:n.text}),o.show();var d=n.buttons||[];c.buttons.forEach(function(e,t){var n=o.$.find(`button[data-index="${t}"]`),r=d[t]||e.text;n.html(r)})}return{show:function(e,t){var n="object"==typeof e?e:{text:e,ok:t};a?s.push(n):f(n)}}}),q("Confirm.defaults",{mask:!0,height:140,autoClose:!0,volatile:!1,"z-index":99999,buttons:[{text:"确定",cmd:"ok",cssClass:"OK"},{text:"取消",cmd:"cancel",cssClass:"Cancel"}]}),q("API",function(e,t,n){var r=e("Emitter"),i=e("Defaults"),o=e("Fn"),a=e("Mapper");function s(e,n){"object"==typeof e&&(n=e,e=""),e=e||"",n=i.clone(t.id,n);var s=new r(this),u=n.successCode,l=n.proxy;switch(l){case!0:l=e+".js";break;case".json":case".js":l=e+l}var c={name:e,data:n.data,query:n.query,url:n.url,prefix:n.prefix,ext:n.ext,random:n.random,successCode:u,field:n.field,proxy:l,serialize:n.serialize,timeout:n.timeout,headers:n.headers,success:function(e,t,n){h("success",[e,t,n])},fail:function(e,t,n,r){h("fail",[e,t,n,r])},error:function(e){d.aborted?d.aborted=!1:h("error",[e])},ontimeout:function(e){h("timeout",[e])}},f=t.require("Ajax"),d={ajax:c,status:"",args:[],emitter:s,xhr:null,aborted:!1,fireEvent:h,get:n.get||f.get,post:n.post||f.post};function h(e,t,r){e=d.status=e||d.status,t=d.args=t||d.args,r=r||d.emitter,d.xhr=null;var i=t.length,a=t[i-1],s=t[i-2],l="success"==e,c="fail"==e;o.delay(n.delay,function(){var n=r.fire("response",[e,s,a]);if(!n.includes(!1)){if(l||c){var i=l?u:t[0];if((n=r.fire("code",i,t)).includes(!1))return}a&&(n=r.fire("status",a.status,t)).includes(!1)||(n=r.fire(e,t)).includes(!1)||r.fire("done",[e,s,a])}})}a.set(this,d)}return s.prototype={constructor:s,get:function(e){var t=a.get(this),n=t.emitter;t.aborted=!1;var r=x.assign({},t.ajax);e&&(r.data=e),e=r.data,n.fire("request","get",[e]),n.fire("request",["get",e]),t.xhr=t.get(r)},post:function(e,t){var n=a.get(this),r=n.emitter,i=n.ajax;n.aborted=!1;var o=x.assign({},i,{data:e||i.data,query:t||i.query});e=o.data,t=o.query,r.fire("request","post",[e,t]),r.fire("request",["post",e,t]),n.xhr=n.post(o)},abort:function(){var e=a.get(this),t=e.xhr;t&&(e.aborted=!0,t.abort(),e.emitter.fire("abort"))},on:function(e,t){var n=a.get(this),i=n.emitter,o=[].slice.call(arguments,0);i.on.apply(i,o);var s=n.status;if(s){var u=new r(this);u.on.apply(u,o),n.fireEvent(s,n.args,u),u.destroy()}},destroy:function(){a.get(this).emitter.destroy(),a.delete(this)}},s}),q("API.defaults",{successCode:200,field:{code:"code",msg:"msg",data:"data"},proxy:null,delay:!1,random:!0,url:"",prefix:"",ext:"",data:null,query:null,headers:null,timeout:0,serialize:function(e,t){var n=y.stringify(t);return encodeURIComponent(n)},get:null,post:null}),q("API/Ajax",function(e,t,n){var r=e("Object"),i=e("String"),o=e("Query");function a(t,n){var a=n.proxy;if(a)return e("Proxy").request(a,n),null;var s=[n.url,n.prefix,n.name,n.ext].join(""),u=n.data||null;if(u){var l=n.serialize;u=r.map(u,function(e,t){return"object"==typeof t&&t?l(e,t):t})}if("post"==t){var c=n.query;c&&(s=o.add(s,c)),u&&(u=o.stringify(u))}else u&&(s=o.add(s,u),u=null);var d=n.random;d&&(d=i.random(4),s=o.add(s,d));var h=!1,p=null,g=n.timeout||0;g>0&&(p=f(function(){h=!0,v.abort();var e=n.ontimeout;e&&e(v)},g));var v=new XMLHttpRequest;v.open(t,s,!0),v.onreadystatechange=function(){if(!h&&4==v.readyState){clearTimeout(p);var t=n.successCode,r=n.error;if(200==v.status){var i=e("JSON").parse(v.responseText);if(i){var o=n.field,a=i[o.code];if(a==t){var s=n.success,u=o.data in i?i[o.data]:{};s&&s(u,i,v)}else{var l=n.fail;l&&l(a,i[o.msg],i,v)}}else r&&r(v)}else r&&r(v)}};var m=n.headers;return m&&r.each(m,function(e,t){v.setRequestHeader(e,t)}),"post"==t&&v.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),v.send(u),v}return{get:function(e){return a("get",e)},post:function(e){return a("post",e)}}}),q("Tabs",function(e,t,n){var r=e("Emitter"),i=e("Object"),o=e("Template"),a=e("Defaults"),s=t.require("Events"),u=t.require("Meta"),l=new w;function c(e,n){i.isPlain(e)&&(e=(n=e).container),n=a.clone(t.id,n);var o=new r(this),s=u.create(n,{container:e,this:this,emitter:o,$:k(e)});l.set(this,s),x.assign(this,{container:e,id:s.id,$:s.$})}return c.prototype={constructor:c,container:"",id:"",$:null,template:function(e){var t=l.get(this),n=t.tpl;return n||(n=t.tpl=new o(t.container)),e&&n.process(...arguments),n},fill:function(e,t){var n=l.get(this),r=this.template(t).fill(e);return n.$.html(r),n.list=e,n.reset(),n.emitter.fire("fill",[e]),r},render:function(e,t){var n=l.get(this);n.change||s.bind(n),e&&this.fill(e,t),n.emitter.fire("render",[e])},active:function(e,t){var n=!0;"boolean"==typeof t?(n=t,t={}):t=t||{};var r=l.get(this),i=r.current;if(e!=i.index||r.repeated){var o=r.list[e]||null,a=r.activedClass,s=x.assign({},i);i.$&&i.$.removeClass(a),i.index=e,i.item=o,i.event=t.event,i.$=r.$.find(`${r.selector}:eq(${e})`);var u={current:i,old:s,options:t};r.activing(u,function(){if(i.$.addClass(a),n){var t=[o,e,u],s=o&&o.cmd||"";r.emitter.fire("before-change",t),r.emitter.fire("change",`${e}`,t),s&&r.emitter.fire("change",s,t),r.emitter.fire("change",t)}})}},remove:function(e){var t=l.get(this),n=t.current.index;t.fire("before-remove",[e]),e<n?this.active(n-1,!1):e==n&&t.reset(),t.list.splice(e,1),t.fire("remove",[e])},reset:function(){l.get(this).reset()},getActivedIndex:function(){return l.get(this).current.index},activing:function(e){var t=l.get(this);if("function"!=typeof(e=e||t.activing))throw new v("参数 fn 必须为 function 类型。");return t.activing=e,e},on:function(...e){l.get(this).emitter.on(...e)},destroy:function(){var e=l.get(this);e.emitter.destroy(),e.tpl.destroy(),e.$.off(),l.delete(this)}},c}),q("Tabs.defaults",{current:null,pressedClass:"",activedClass:"",eventName:"click",selector:">*",repeated:!1}),q("Tabs.config",{eventName:"click"}),q("Tabs/Events",function(e,t,n){e("Array"),e("String");return{bind:function(e){var t=e.eventName,n=e.selector,r=e.pressedClass;e.change=function(t){var r=this,i=e.$.find(n).toArray().findIndex(function(e){return e===r});e.this.active(i,{event:t})},e.$.on(t,n,e.change),e.$.on("mousedown",n,function(e){k(this).addClass(r)}),e.$.on("mouseup mouseout",n,function(e){k(this).removeClass(r)})}}}),q("Tabs/Meta",function(e,t,n){e("$"),e("String");var r=e("RandomId");return{create:function(e,t){var n={id:r.get("KISP-Tabs-",4),activedClass:e.activedClass||"",pressedClass:e.pressedClass||"",eventName:e.eventName||"",selector:e.selector||"",repeated:!!e.repeated,list:e.list||[],current:{index:-1,item:null,event:null,$:null},container:null,tpl:null,emitter:null,this:null,$:null,change:null,reset:function(){n.$.find(n.selector).removeClass(n.activedClass),n.current={index:-1,item:null,event:null,$:null}},activing:function(e,t){t()}};return x.assign(n,t),n}}}),q("Toast",function(e,t,n){var r=e("String"),i=e("Emitter"),o=e("Defaults"),a=t.require("Sample"),s=t.require("Style"),u=t.require("Meta"),l=t.require("Masker"),c=new w;function d(e){e=o.clone(t.id,e);var n=new i(this),r=s.get(e),f=l.create(e),d=u.create(e,{sample:a,style:r,emitter:n,masker:f,this:this});c.set(this,d),x.assign(this,{id:d.id})}return d.prototype={constructor:d,id:"",$:null,render:function(){var t=c.get(this);if(!t.$){var n=e("Style").stringify(t.style),i=r.format(t.sample,{id:t.id,icon:t.icon,text:t.text,textId:t.textId,iconId:t.iconId,cssClass:t.cssClass,style:n});k(t.container).append(i),t.$=this.$=k(`#${t.id}`),t.$icon=k(`#${t.iconId}`),t.$text=k(`#${t.textId}`),t.emitter.fire("render")}},show:function(e,t){"function"==typeof e&&(t=e,e=j);var n=c.get(this),r=n.masker,i=n.duration;n.$||this.render(),r&&r.show(),"string"==typeof e&&(n.text=e,n.$text.html(e)),i&&f(function(){n.this.hide(),t&&t()},i),n.$.toggleClass("NoIcon",!n.icon),n.$.toggleClass("NoText",!n.text),n.$.show(),n.emitter.fire("show")},hide:function(){var e=c.get(this),t=e.masker;e.$&&(t&&t.hide(),e.$.hide(),e.emitter.fire("hide"))},remove:function(){var e=c.get(this);if(e.$){var t=e.$.get(0),n=e.masker;t.parentNode.removeChild(t),n&&n.remove(),e.$.off(),e.$=this.$=null,e.$icon=null,e.$text=null,e.masker=null,e.emitter.fire("remove")}},on:function(...e){c.get(this).emitter.on(...e)},destroy:function(){var e=c.get(this);this.remove(),e.emitter.destroy(),c.remove(this)}},d}),q("Toast.defaults",{text:"",container:"body",mask:!1,icon:"check",duration:0,cssClass:"","z-index":1024,width:"",height:"",style:{}}),q("Toast/Sample",['<div id="{id}" class="KISP Toast {cssClass}" style="{style}">',"    <div>",'        <i id="{iconId}" class="fa fa-{icon}"></i>',"    </div>",'    <span id="{textId}" class="Text">{text}</span>',"</div>"].join("\n")),q("Toast/Style",function(e,t,n){var r=e("Object"),i=e("Style");return{get:function(e){var t=r.filter(e,["height","width","z-index"]),n=i.objectify(e.style);return n=i.merge(n,t),n=i.pixelize(n,["height","width"])}}}),q("Toast/Meta",function(e,t,n){e("$"),e("String");var r=e("RandomId");return{create:function(e,t){var n=r.get("KISP-Toast-",4),i=r.get("KISP-Toast-","text-",4),o=r.get("KISP-Toast-","icon-",4),a=e.text;a=(a="number"==typeof a?C(a):a)||"";var s={id:n,icon:e.icon,text:a,textId:i,iconId:o,cssClass:e.cssClass||"",container:e.container,duration:e.duration||0,sample:"",style:"",masker:null,emitter:null,this:null,$:null,$icon:null,$text:null};return x.assign(s,t),s}}}),q("Toast/Masker",function(e,t,n){e("$");return{create:function(t){var n=e("Mask"),r={container:t.container},i=n.normalize(r,t.mask);return i?(x.assign(i,{"z-index":t["z-index"]-1}),new n(i)):null}}}),q("Scroller/Pulldown/Indicator/Sample",["","",'<div id="{id}" class="Scroller-Pulldown-Indicator" style="display: none; transform: translateY({translateY}px);">下拉刷新</div>'].join("\n")),q("Scroller/Pullup/Indicator/Sample",["","",'<div id="{id}" class="Scroller-Pullup-Indicator" style="display: none; transform: translateY({translateY}px); ">上拉加载更多</div>'].join("\n")),q("Loading/Sample/IOS",['<div id="{id}" class="KISP Loading-iOS {cssClass}" >','    <div class="Main">','        <div class="Item-0"></div>','        <div class="Item-1"></div>','        <div class="Item-2"></div>','        <div class="Item-3"></div>','        <div class="Item-4"></div>','        <div class="Item-5"></div>','        <div class="Item-6"></div>','        <div class="Item-7"></div>','        <div class="Item-8"></div>','        <div class="Item-9"></div>','        <div class="Item-10"></div>','        <div class="Item-11"></div>',"    </div>",'    <span id="{textId}" class="Text">{text}</span>',"</div>"].join("\n")),I=M.require,T=I("KISP"),P=I("OuterModule"),e.KISP=T,e.define=P.define}(window,top,parent,window,document,location,navigator,localStorage,sessionStorage,console,history,setTimeout,setInterval,Array,Boolean,Date,Error,Function,JSON,Map,Math,Number,Object,RegExp,String,window.jQuery,void 0);